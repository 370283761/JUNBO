# 飞书应用配置指南

本指南将帮助您在飞书开放平台创建应用并获取必要的凭证，以便 Claude 能够读取飞书文档。

## 第一步：创建飞书企业自建应用

### 1.1 访问飞书开放平台

打开浏览器，访问：https://open.feishu.cn/

### 1.2 登录账号

使用您的飞书账号登录飞书开放平台。

### 1.3 创建应用

1. 点击右上角【创建企业自建应用】按钮
2. 填写应用信息：
   - **应用名称**：例如 "Claude MCP 文档助手"
   - **应用描述**：例如 "用于 Claude 读取和处理飞书文档"
   - **应用图标**：可选���上传一个图标
3. 点击【确定创建】

### 1.4 获取凭证

创建完成后，您将看到应用的详情页面：

1. 在【凭证与基础信息】标签页中
2. 找到并记录以下信息：
   - **App ID**（应用 ID）：格式如 `cli_xxxxxxxxxx`
   - **App Secret**（应用密钥）：点击【点击查看】获取

⚠️ **重要提示**：
- App Secret 非常敏感，请妥善保管，不要泄露
- 建议复制到安全的密码管理工具中
- 如果不小心泄露，可以重新生成

## 第二步：配置应用权限

### 2.1 进入权限管理

在应用详情页面，点击左侧菜单【权限管理】。

### 2.2 申请必需权限

根据您的需求，申请以下权限：

#### 基础权限（必需）

这些权限是读取文档的最低要求：

| 权限代码 | 权限名称 | 说明 |
|---------|---------|------|
| `docx:document` | 查看、评论和编辑文档 | 读取新版文档（Docs）内容 |
| `docs:read` | 查看文档 | 读取旧版文档内容 |
| `drive:drive.readonly` | 查看云空间文件 | 列出文件夹和文档列表 |

#### 知识库权限（推荐）

如果需要访问知识库：

| 权限代码 | 权限名称 | 说明 |
|---------|---------|------|
| `wiki:wiki.readonly` | 查看知识库 | 读取知识库文档 |

#### 扩展权限（可选）

如果需要更多功能：

| 权限代码 | 权限名称 | 说明 |
|---------|---------|------|
| `im:message` | 获取与发送单聊、群组消息 | 读取消息内容 |
| `im:chat` | 获取群组信息 | 访问群聊信息 |
| `bitable:app` | 查看、评论、编辑和管理多维表格 | 访问多维表格 |

### 2.3 申请权限的步骤

1. 在权限列表中找到需要的权限
2. 点击权限右侧的【申请权限】按钮
3. 填写权限申请说明（例如："用于 Claude AI 读取文档内容"）
4. 提交申请

⚠️ **注意**：
- 某些权限可能需要管理员审批
- 权限申请通过后才能使用

## 第三步：发布应用

### 3.1 配置应用可用范围

1. 点击左侧菜单【应用发布】
2. 选择应用可用范围：
   - **所有员工**：所有人都能使用该应用
   - **部分员工**：仅指定部门或人员能使用
3. 点击【创建版本】

### 3.2 提交审核

1. 填写版本信息和更新说明
2. 点击【提交审核】
3. 等待管理员审核通过

### 3.3 启用应用

审核通过后：
1. 应用状态会变为【已启用】
2. 现在可以使用 App ID 和 App Secret 访问飞书 API 了

## 第四步：将应用添加到文档

要让应用能够访问特定的文档，需要将应用添加到文档的可见范围：

### 方法一：通过文档设置

1. 打开需要访问的飞书文档
2. 点击右上角【...】菜单
3. 选择【添加应用】
4. 搜索并选择您创建的应用
5. 点击【确认】

### 方法二：通过文件夹设置

1. 在云文档中找到文件夹
2. 右键点击文件夹，选择【设置】
3. 在【协作者】中添加您的应用
4. 该文件夹下的所有文档都将对应用可见

## 第五步：验证配置

完成以上步骤后，您应该有：

- ✅ **App ID**：`cli_xxxxxxxxxx`
- ✅ **App Secret**：`xxxxxxxxxxxxxxxxxxx`
- ✅ 已申请并获得必要的权限
- ✅ 应用状态为【已启用】
- ✅ 应用已添加到需要访问的文档

## 常见问题

### Q1: 权限申请后多久生效？

A: 通常立即生效。如果需要管理员审批，取决于审批速度。

### Q2: 如何知道应用是否有权限访问某个文档？

A:
1. 尝试用 API 读取文档，如果返回权限错误，说明应用未添加到文档
2. 在文档的协作者列表中查看是否有您的应用

### Q3: App Secret 泄露了怎么办？

A:
1. 立即在飞书开放平台重新生成 App Secret
2. 更新所有使用该 Secret 的配置
3. 排查泄露原因，防止再次发生

### Q4: 应用无法访问某些文档？

A: 请确认：
- 应用已添加到该文档的协作者列表
- 应用已申请并获得 `docx:document` 或 `docs:read` 权限
- 应用状态为【已启用】

### Q5: 需要用户授权吗？

A:
- 使用应用访问凭证（tenant_access_token）：不需要用���授权
- 使用用户访问凭证（user_access_token）：需要用户授权

对于只读文档的场景，推荐使用应用访问凭证（tenant）。

## 下一步

完成飞书应用配置后，请继续：

1. 阅读 [Claude Desktop 配置指南](CLAUDE_DESKTOP_SETUP.md)
2. 或运行一键配置脚本：`./setup-feishu-mcp.sh`

## 参考资源

- 飞书开放平台文档：https://open.feishu.cn/document/home/introduction-to-scope-and-authorization/overview
- 飞书 API 文档：https://open.feishu.cn/document/server-docs/docs/docs-overview
