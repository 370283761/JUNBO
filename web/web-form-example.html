<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web 表单案例 - 用户注册 | UI/UE 设计规范</title>
    <meta name="description" content="基于 UI/UE 设计规范的 Web 表单示例">
    <link rel="stylesheet" href="ui-ue-design-system.css">
    <style>
        /* 页面布局 */
        .page-container {
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-lg);
        }

        .form-container {
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 500px;
            width: 100%;
            padding: var(--spacing-xxl);
        }

        .form-header {
            text-align: center;
            margin-bottom: var(--spacing-xl);
        }

        .form-header h1 {
            color: var(--color-text-primary);
            margin-bottom: var(--spacing-sm);
        }

        .form-header p {
            color: var(--color-text-secondary);
            margin-bottom: 0;
        }

        /* 密码强度指示器 */
        .password-strength {
            height: 4px;
            background: var(--color-bg-secondary);
            border-radius: var(--radius-full);
            margin-top: var(--spacing-xs);
            overflow: hidden;
        }

        .password-strength-bar {
            height: 100%;
            transition: all var(--transition-normal);
            border-radius: var(--radius-full);
        }

        .password-strength-weak {
            width: 33%;
            background: var(--color-error);
        }

        .password-strength-medium {
            width: 66%;
            background: var(--color-warning);
        }

        .password-strength-strong {
            width: 100%;
            background: var(--color-success);
        }

        /* 验证码组合 */
        .verification-group {
            display: flex;
            gap: var(--spacing-sm);
        }

        .verification-input {
            flex: 1;
        }

        .verification-btn {
            white-space: nowrap;
            min-width: 120px;
        }

        /* 表单底部 */
        .form-footer {
            margin-top: var(--spacing-xl);
            padding-top: var(--spacing-lg);
            border-top: 1px solid var(--color-border);
            text-align: center;
            font-size: var(--font-size-caption-desktop);
            color: var(--color-text-secondary);
        }

        .form-footer a {
            color: var(--color-primary);
            text-decoration: none;
        }

        .form-footer a:hover {
            text-decoration: underline;
        }

        /* 复选框自定义 */
        .checkbox-group {
            display: flex;
            align-items: flex-start;
            gap: var(--spacing-sm);
        }

        .checkbox-group input[type="checkbox"] {
            margin-top: 4px;
            cursor: pointer;
        }

        .checkbox-group label {
            font-size: var(--font-size-caption-desktop);
            color: var(--color-text-secondary);
            cursor: pointer;
        }

        /* 移动端优化 */
        @media (max-width: 767px) {
            .page-container {
                padding: var(--spacing-md);
                align-items: flex-start;
            }

            .form-container {
                padding: var(--spacing-lg);
            }

            .verification-group {
                flex-direction: column;
            }

            .verification-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- 无障碍：跳转到主内容 -->
    <a href="#main-content" class="skip-to-main">跳转到主内容</a>

    <div class="page-container">
        <div class="form-container" id="main-content" role="main">
            <!-- 表单头部 -->
            <div class="form-header">
                <h1>创建账号</h1>
                <p>填写以下信息完成注册</p>
            </div>

            <!-- 表单主体 (遵循 3.3 表单设计规范) -->
            <form id="registerForm" novalidate>

                <!-- 手机号 (必填) -->
                <div class="form-group">
                    <label for="phone" class="form-label form-label-required">手机号</label>
                    <input
                        type="tel"
                        id="phone"
                        name="phone"
                        class="form-input"
                        placeholder="请输入11位手机号码"
                        pattern="^1[3-9]\d{9}$"
                        required
                        aria-required="true"
                        aria-describedby="phone-help"
                    >
                    <p id="phone-help" class="form-help-text">用于登录和接收验证码</p>
                    <p class="form-error-message" id="phone-error" role="alert" style="display: none;">
                        <span>⚠️</span>
                        <span>请输入正确的手机号格式</span>
                    </p>
                </div>

                <!-- 验证码 (必填) -->
                <div class="form-group">
                    <label for="code" class="form-label form-label-required">验证码</label>
                    <div class="verification-group">
                        <input
                            type="text"
                            id="code"
                            name="code"
                            class="form-input verification-input"
                            placeholder="请输入6位验证码"
                            maxlength="6"
                            pattern="\d{6}"
                            required
                            aria-required="true"
                        >
                        <button
                            type="button"
                            class="btn btn-secondary verification-btn"
                            id="sendCodeBtn"
                            onclick="sendVerificationCode()"
                        >
                            获取验证码
                        </button>
                    </div>
                    <p class="form-error-message" id="code-error" role="alert" style="display: none;">
                        <span>⚠️</span>
                        <span>请输入6位数字验证码</span>
                    </p>
                </div>

                <!-- 用户名 (必填) -->
                <div class="form-group">
                    <label for="username" class="form-label form-label-required">用户名</label>
                    <input
                        type="text"
                        id="username"
                        name="username"
                        class="form-input"
                        placeholder="4-20个字符，可使用字母、数字、下划线"
                        minlength="4"
                        maxlength="20"
                        pattern="^[a-zA-Z0-9_]{4,20}$"
                        required
                        aria-required="true"
                        aria-describedby="username-help"
                    >
                    <p id="username-help" class="form-help-text">此用户名将作为您的个人主页地址</p>
                    <p class="form-error-message" id="username-error" role="alert" style="display: none;">
                        <span>⚠️</span>
                        <span>用户名格式不正确</span>
                    </p>
                </div>

                <!-- 密码 (必填，带强度提示) -->
                <div class="form-group">
                    <label for="password" class="form-label form-label-required">设置密码</label>
                    <input
                        type="password"
                        id="password"
                        name="password"
                        class="form-input"
                        placeholder="至少8位，需包含字母和数字"
                        minlength="8"
                        required
                        aria-required="true"
                        aria-describedby="password-help password-strength-text"
                        oninput="checkPasswordStrength()"
                    >
                    <!-- 密码强度指示器 (遵循 3.3.2 输入规范) -->
                    <div class="password-strength">
                        <div class="password-strength-bar" id="strengthBar"></div>
                    </div>
                    <p id="password-help" class="form-help-text">
                        密码强度：<span id="password-strength-text">未输入</span>
                    </p>
                    <p class="form-error-message" id="password-error" role="alert" style="display: none;">
                        <span>⚠️</span>
                        <span>密码至少8位，需包含字母和数字</span>
                    </p>
                </div>

                <!-- 确认密码 (必填) -->
                <div class="form-group">
                    <label for="confirmPassword" class="form-label form-label-required">确认密码</label>
                    <input
                        type="password"
                        id="confirmPassword"
                        name="confirmPassword"
                        class="form-input"
                        placeholder="请再次输入密码"
                        required
                        aria-required="true"
                    >
                    <p class="form-error-message" id="confirmPassword-error" role="alert" style="display: none;">
                        <span>⚠️</span>
                        <span>两次输入的密码不一致</span>
                    </p>
                </div>

                <!-- 邮箱 (可选) -->
                <div class="form-group">
                    <label for="email" class="form-label">邮箱（可选）</label>
                    <input
                        type="email"
                        id="email"
                        name="email"
                        class="form-input"
                        placeholder="example@email.com"
                        aria-describedby="email-help"
                    >
                    <p id="email-help" class="form-help-text">用于找回密码和接收通知</p>
                </div>

                <!-- 用户协议 (遵循无障碍标准) -->
                <div class="form-group">
                    <div class="checkbox-group">
                        <input
                            type="checkbox"
                            id="agreement"
                            name="agreement"
                            required
                            aria-required="true"
                        >
                        <label for="agreement">
                            我已阅读并同意
                            <a href="#" onclick="showAgreement(event)">《用户协议》</a>
                            和
                            <a href="#" onclick="showPrivacy(event)">《隐私政策》</a>
                        </label>
                    </div>
                    <p class="form-error-message" id="agreement-error" role="alert" style="display: none;">
                        <span>⚠️</span>
                        <span>请阅读并同意用户协议和隐私政策</span>
                    </p>
                </div>

                <!-- 提交按钮 (遵循 3.3.3 提交按钮规范) -->
                <button
                    type="submit"
                    class="btn btn-primary"
                    id="submitBtn"
                    style="width: 100%;"
                >
                    立即注册
                </button>

            </form>

            <!-- 表单底部 -->
            <div class="form-footer">
                已有账号？<a href="#" onclick="goToLogin(event)">立即登录</a>
            </div>
        </div>
    </div>

    <!-- Toast 提示 (遵循 3.2.2 反馈规范) -->
    <div id="toast" style="display: none;"></div>

    <!-- Modal 对话框 -->
    <div id="modal" class="modal-overlay" style="display: none;" role="dialog" aria-modal="true" aria-labelledby="modal-title">
        <div class="modal-content">
            <div class="modal-header" id="modal-title">操作确认</div>
            <div id="modal-body"></div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="closeModal()">取消</button>
                <button type="button" class="btn btn-primary" onclick="confirmModal()">确定</button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // 表单验证逻辑 (遵循 3.3.2 输入规范 - 失焦验证)
        // ============================================

        const form = document.getElementById('registerForm');
        const fields = ['phone', 'code', 'username', 'password', 'confirmPassword'];

        // 为每个字段添加失焦验证
        fields.forEach(fieldName => {
            const field = document.getElementById(fieldName);
            field.addEventListener('blur', () => validateField(fieldName));
            // 错误状态下，实时验证
            field.addEventListener('input', () => {
                if (field.classList.contains('form-input-error')) {
                    validateField(fieldName);
                }
            });
        });

        // 验证单个字段
        function validateField(fieldName) {
            const field = document.getElementById(fieldName);
            const error = document.getElementById(`${fieldName}-error`);
            let isValid = true;
            let errorMessage = '';

            // 必填验证
            if (field.hasAttribute('required') && !field.value.trim()) {
                isValid = false;
                errorMessage = '此项为必填项';
            }
            // 格式验证
            else if (field.value && field.pattern && !new RegExp(field.pattern).test(field.value)) {
                isValid = false;
                errorMessage = field.placeholder || '格式不正确';
            }
            // 特殊验证：确认密码
            else if (fieldName === 'confirmPassword') {
                const password = document.getElementById('password').value;
                if (field.value !== password) {
                    isValid = false;
                    errorMessage = '两次输入的密码不一致';
                }
            }

            // 更新UI状态
            if (!isValid) {
                field.classList.add('form-input-error');
                error.style.display = 'flex';
                error.querySelector('span:last-child').textContent = errorMessage;
                field.setAttribute('aria-invalid', 'true');
            } else {
                field.classList.remove('form-input-error');
                error.style.display = 'none';
                field.setAttribute('aria-invalid', 'false');
            }

            return isValid;
        }

        // ============================================
        // 密码强度检测
        // ============================================

        function checkPasswordStrength() {
            const password = document.getElementById('password').value;
            const strengthBar = document.getElementById('strengthBar');
            const strengthText = document.getElementById('password-strength-text');

            if (!password) {
                strengthBar.className = 'password-strength-bar';
                strengthText.textContent = '未输入';
                return;
            }

            let strength = 0;
            // 长度检查
            if (password.length >= 8) strength++;
            if (password.length >= 12) strength++;
            // 包含数字
            if (/\d/.test(password)) strength++;
            // 包含小写字母
            if (/[a-z]/.test(password)) strength++;
            // 包含大写字母
            if (/[A-Z]/.test(password)) strength++;
            // 包含特殊字符
            if (/[^a-zA-Z0-9]/.test(password)) strength++;

            if (strength <= 2) {
                strengthBar.className = 'password-strength-bar password-strength-weak';
                strengthText.textContent = '弱';
                strengthText.style.color = 'var(--color-error)';
            } else if (strength <= 4) {
                strengthBar.className = 'password-strength-bar password-strength-medium';
                strengthText.textContent = '中';
                strengthText.style.color = 'var(--color-warning)';
            } else {
                strengthBar.className = 'password-strength-bar password-strength-strong';
                strengthText.textContent = '强';
                strengthText.style.color = 'var(--color-success)';
            }
        }

        // ============================================
        // 发送验证码 (遵循 3.2.1 即时反馈原则)
        // ============================================

        let countdown = 60;
        let countdownTimer = null;

        function sendVerificationCode() {
            const phoneField = document.getElementById('phone');

            // 先验证手机号
            if (!validateField('phone')) {
                phoneField.focus();
                return;
            }

            const btn = document.getElementById('sendCodeBtn');

            // 模拟发送验证码 (实际应调用 API)
            btn.disabled = true;
            btn.classList.add('btn-loading');
            btn.textContent = '发送中...';

            setTimeout(() => {
                btn.classList.remove('btn-loading');
                showToast('验证码已发送', 'success');

                // 开始倒计时
                startCountdown();
            }, 1000);
        }

        function startCountdown() {
            const btn = document.getElementById('sendCodeBtn');
            countdown = 60;

            btn.textContent = `${countdown}秒后重试`;

            countdownTimer = setInterval(() => {
                countdown--;
                btn.textContent = `${countdown}秒后重试`;

                if (countdown <= 0) {
                    clearInterval(countdownTimer);
                    btn.disabled = false;
                    btn.textContent = '重新获取';
                }
            }, 1000);
        }

        // ============================================
        // 表单提交 (遵循 3.2.1 操作反馈)
        // ============================================

        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            // 验证所有字段
            let allValid = true;
            fields.forEach(fieldName => {
                if (!validateField(fieldName)) {
                    allValid = false;
                }
            });

            // 验证用户协议
            const agreement = document.getElementById('agreement');
            const agreementError = document.getElementById('agreement-error');
            if (!agreement.checked) {
                agreementError.style.display = 'flex';
                allValid = false;
            } else {
                agreementError.style.display = 'none';
            }

            if (!allValid) {
                showToast('请检查表单填写', 'error');
                // 聚焦到第一个错误字段
                const firstError = document.querySelector('.form-input-error');
                if (firstError) firstError.focus();
                return;
            }

            // 提交表单 - 显示加载状态
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.classList.add('btn-loading');
            submitBtn.textContent = '注册中...';

            // 模拟 API 请求 (实际应调用后端接口)
            setTimeout(() => {
                submitBtn.classList.remove('btn-loading');
                submitBtn.disabled = false;
                submitBtn.textContent = '立即注册';

                // 成功提示
                showToast('注册成功！即将跳转...', 'success');

                // 3秒后跳转
                setTimeout(() => {
                    console.log('跳转到首页');
                    // window.location.href = '/dashboard';
                }, 2000);
            }, 2000);
        });

        // ============================================
        // Toast 提示 (遵循 3.2.2 反馈规范)
        // ============================================

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast toast-${type}`;
            toast.style.display = 'block';
            toast.setAttribute('role', 'alert');
            toast.setAttribute('aria-live', 'polite');

            // 2-3秒后自动消失
            setTimeout(() => {
                toast.style.display = 'none';
            }, 2500);
        }

        // ============================================
        // Modal 对话框
        // ============================================

        function showAgreement(e) {
            e.preventDefault();
            const modal = document.getElementById('modal');
            const modalTitle = document.getElementById('modal-title');
            const modalBody = document.getElementById('modal-body');

            modalTitle.textContent = '用户协议';
            modalBody.innerHTML = `
                <p>这是用户协议的内容示例...</p>
                <p style="margin-top: 16px;">1. 服务条款</p>
                <p>2. 用户权利与义务</p>
                <p>3. 隐私保护</p>
            `;

            modal.style.display = 'flex';
            // 聚焦到 Modal
            modal.querySelector('.btn-primary').focus();
        }

        function showPrivacy(e) {
            e.preventDefault();
            const modal = document.getElementById('modal');
            const modalTitle = document.getElementById('modal-title');
            const modalBody = document.getElementById('modal-body');

            modalTitle.textContent = '隐私政策';
            modalBody.innerHTML = `
                <p>这是隐私政策的内容示例...</p>
                <p style="margin-top: 16px;">我们如何收集和使用您的信息：</p>
                <p>1. 信息收集</p>
                <p>2. 信息使用</p>
                <p>3. 信息保护</p>
            `;

            modal.style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('modal').style.display = 'none';
        }

        function confirmModal() {
            closeModal();
        }

        function goToLogin(e) {
            e.preventDefault();
            showToast('跳转到登录页面...', 'info');
        }

        // 键盘支持 (Escape 关闭 Modal)
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                const modal = document.getElementById('modal');
                if (modal.style.display === 'flex') {
                    closeModal();
                }
            }
        });
    </script>
</body>
</html>
