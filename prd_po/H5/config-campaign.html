<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é…ç½®å¹¿å‘Šè®¡åˆ’ - å¹¿å‘Šæ‰¹é‡åˆ›ç¼–</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div class="page-container">
    <!-- é¡µé¢å¤´éƒ¨ -->
    <div class="page-header">
      <h1 class="page-title">æ‰¹é‡åˆ›ç¼– > é…ç½®</h1>
      <div class="flex gap-3">
        <button class="btn btn-text" onclick="saveDraft()">ğŸ’¾ ä¿å­˜è‰ç¨¿</button>
        <button class="btn btn-default" onclick="goBack()">è¿”å›</button>
      </div>
    </div>

    <!-- è¿›åº¦æŒ‡ç¤ºå™¨ -->
    <div class="steps">
      <div class="step current">
        <div class="step-icon">1</div>
        <div class="step-label">å¹¿å‘Šè®¡åˆ’</div>
      </div>
      <div class="step-line"></div>
      <div class="step">
        <div class="step-icon">2</div>
        <div class="step-label">å¹¿å‘Šç»„</div>
      </div>
      <div class="step-line"></div>
      <div class="step">
        <div class="step-icon">3</div>
        <div class="step-label">å¹¿å‘Šåˆ›æ„</div>
      </div>
      <div class="step-line"></div>
      <div class="step">
        <div class="step-icon">4</div>
        <div class="step-label">å˜é‡è®¾ç½®</div>
      </div>
      <div class="step-line"></div>
      <div class="step">
        <div class="step-icon">5</div>
        <div class="step-label">é¢„è§ˆç¡®è®¤</div>
      </div>
    </div>

    <!-- ä¸»è¦å†…å®¹åŒº -->
    <div class="page-content">
      <div class="config-container">
        <!-- å·¦ä¾§å¯¼èˆª -->
        <div class="config-sidebar">
          <h3 style="margin-bottom: 20px; font-size: 16px;">é…ç½®å¯¼èˆª</h3>
          <div class="config-nav-item active">
            <span>ğŸ“‹</span>
            <span>å¹¿å‘Šè®¡åˆ’</span>
          </div>
          <div class="config-nav-item" style="opacity: 0.5; cursor: not-allowed;">
            <span>ğŸ¯</span>
            <span>å¹¿å‘Šç»„</span>
          </div>
          <div class="config-nav-item" style="opacity: 0.5; cursor: not-allowed;">
            <span>ğŸ¨</span>
            <span>å¹¿å‘Šåˆ›æ„</span>
          </div>
          <div class="config-nav-item" style="opacity: 0.5; cursor: not-allowed;">
            <span>âš™ï¸</span>
            <span>å˜é‡è®¾ç½®</span>
          </div>

          <div style="margin-top: 32px; padding: 16px; background: var(--gray-1); border-radius: var(--radius-md);">
            <h4 style="margin-bottom: 8px; font-size: 14px;">é¢„è§ˆæ‘˜è¦</h4>
            <div style="font-size: 12px; color: var(--secondary); line-height: 1.8;">
              <div>å°†ç”Ÿæˆï¼š<strong id="previewCount" style="color: var(--primary-6);">0 æ¡å¹¿å‘Š</strong></div>
              <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--gray-3);">
                <div style="color: var(--warning);">âš ï¸ å¾…å®Œæˆï¼š</div>
                <ul style="padding-left: 16px; margin-top: 4px;">
                  <li id="checkCampaign">å¹¿å‘Šè®¡åˆ’</li>
                  <li>å¹¿å‘Šç»„</li>
                  <li>åˆ›æ„ç´ æ</li>
                  <li>å˜é‡è®¾ç½®</li>
                </ul>
              </div>
            </div>
          </div>
        </div>

        <!-- ä¸»é…ç½®åŒº -->
        <div class="config-main">
          <div class="config-section">
            <h2 class="section-title">å¹¿å‘Šè®¡åˆ’é…ç½®</h2>

            <form id="campaignForm">
              <!-- è®¡åˆ’åç§°è§„åˆ™ -->
              <div class="form-group">
                <label class="form-label required">è®¡åˆ’åç§°è§„åˆ™</label>
                <div style="display: flex; gap: 8px;">
                  <input
                    type="text"
                    id="campaignName"
                    class="input"
                    placeholder="ä¾‹å¦‚ï¼š{åŸå¸‚}-{äº§å“}æ¨å¹¿-{æ—¥æœŸ}"
                    value="{åŸå¸‚}-{äº§å“}æ¨å¹¿-{æ—¥æœŸ}"
                  >
                  <button type="button" class="btn btn-default" onclick="showVariableSelector()">
                    æ’å…¥å˜é‡
                  </button>
                </div>
                <div class="form-help">
                  ğŸ’¡ æ”¯æŒå˜é‡ï¼š{åŸå¸‚} {äº§å“} {æ—¥æœŸ} {åºå·}
                </div>
                <div id="namePreview" class="alert alert-info" style="margin-top: 8px; display: none;">
                  <span>å®æ—¶é¢„è§ˆï¼š</span>
                  <span id="namePreviewText"></span>
                </div>
              </div>

              <!-- é¢„ç®—è®¾ç½® -->
              <div class="form-group">
                <label class="form-label required">é¢„ç®—è®¾ç½®</label>
                <div style="display: flex; gap: 16px; align-items: center;">
                  <label class="radio">
                    <input type="radio" name="budgetType" value="unlimited">
                    <span>ä¸é™</span>
                  </label>
                  <label class="radio">
                    <input type="radio" name="budgetType" value="daily" checked>
                    <span>æ—¥é¢„ç®—</span>
                  </label>
                </div>
                <div id="budgetInput" style="margin-top: 12px; display: flex; align-items: center; gap: 8px;">
                  <input
                    type="number"
                    id="dailyBudget"
                    class="input"
                    style="width: 200px;"
                    placeholder="500"
                    value="500"
                    min="100"
                  >
                  <span>å…ƒ/å¤©</span>
                </div>
              </div>

              <!-- æŠ•æ”¾æ—¶æ®µ -->
              <div class="form-group">
                <label class="form-label required">æŠ•æ”¾æ—¶æ®µ</label>
                <div style="display: flex; gap: 16px; align-items: center;">
                  <label class="radio">
                    <input type="radio" name="schedule" value="allday" checked>
                    <span>å…¨å¤©</span>
                  </label>
                  <label class="radio">
                    <input type="radio" name="schedule" value="custom">
                    <span>è‡ªå®šä¹‰æ—¶æ®µ</span>
                  </label>
                  <button type="button" class="btn btn-text btn-small" onclick="Message.info('è‡ªå®šä¹‰æ—¶æ®µåŠŸèƒ½å¼€å‘ä¸­')">
                    è®¾ç½®
                  </button>
                </div>
              </div>

              <!-- æŠ•æ”¾æ—¥æœŸ -->
              <div class="form-group">
                <label class="form-label required">æŠ•æ”¾æ—¥æœŸ</label>
                <div style="display: flex; gap: 12px; align-items: center;">
                  <input
                    type="date"
                    id="startDate"
                    class="input"
                    style="width: 200px;"
                  >
                  <span>è‡³</span>
                  <input
                    type="date"
                    id="endDate"
                    class="input"
                    style="width: 200px;"
                  >
                </div>
              </div>

              <!-- é«˜çº§è®¾ç½® -->
              <div class="form-group">
                <div style="cursor: pointer; display: flex; align-items: center; gap: 8px;" onclick="toggleAdvanced()">
                  <span class="form-label">é«˜çº§è®¾ç½®</span>
                  <span id="advancedIcon" style="transition: transform 0.3s;">â–¼</span>
                </div>
                <div id="advancedSettings" style="display: none; margin-top: 16px; padding: 16px; background: var(--gray-1); border-radius: var(--radius-md);">
                  <div class="form-group mb-4">
                    <label class="form-label">è®¡åˆ’ç±»å‹</label>
                    <select class="input" style="width: 100%;">
                      <option>å¸¸è§„æŠ•æ”¾</option>
                      <option>åŠ é€ŸæŠ•æ”¾</option>
                      <option>å‡åŒ€æŠ•æ”¾</option>
                    </select>
                  </div>

                  <div class="form-group mb-0">
                    <label class="checkbox">
                      <input type="checkbox">
                      <span>å¯ç”¨è‡ªåŠ¨ä¼˜åŒ–</span>
                    </label>
                  </div>
                </div>
              </div>
            </form>
          </div>

          <!-- åº•éƒ¨æ“ä½œæŒ‰é’® -->
          <div style="display: flex; justify-content: space-between; padding: 20px 0;">
            <button class="btn btn-default" onclick="goBack()">
              â† ä¸Šä¸€æ­¥
            </button>
            <div style="display: flex; gap: 12px;">
              <button class="btn btn-default" onclick="saveDraft()">
                ä¿å­˜è‰ç¨¿
              </button>
              <button class="btn btn-primary" onclick="nextStep()">
                ä¸‹ä¸€æ­¥ â†’
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- å˜é‡é€‰æ‹©å™¨å¼¹çª— -->
  <div id="variableModal" class="modal-mask">
    <div class="modal" style="max-width: 400px;">
      <div class="modal-header">
        <span>æ’å…¥å˜é‡</span>
        <button class="modal-close">Ã—</button>
      </div>
      <div class="modal-body">
        <p style="margin-bottom: 16px; color: var(--secondary);">é€‰æ‹©è¦æ’å…¥çš„å˜é‡ï¼š</p>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
          <button class="btn btn-default" onclick="insertVariable('{åŸå¸‚}')" style="justify-content: center;">
            {åŸå¸‚}
          </button>
          <button class="btn btn-default" onclick="insertVariable('{äº§å“}')" style="justify-content: center;">
            {äº§å“}
          </button>
          <button class="btn btn-default" onclick="insertVariable('{æ—¥æœŸ}')" style="justify-content: center;">
            {æ—¥æœŸ}
          </button>
          <button class="btn btn-default" onclick="insertVariable('{åºå·}')" style="justify-content: center;">
            {åºå·}
          </button>
          <button class="btn btn-default" onclick="insertVariable('{ä»·æ ¼}')" style="justify-content: center;">
            {ä»·æ ¼}
          </button>
          <button class="btn btn-default" onclick="insertVariable('{æŠ˜æ‰£}')" style="justify-content: center;">
            {æŠ˜æ‰£}
          </button>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-default" onclick="hideVariableSelector()">å…³é—­</button>
      </div>
    </div>
  </div>

  <script src="js/main.js"></script>
  <script>
    let variableModal;

    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
      variableModal = new Modal('variableModal');

      // è®¾ç½®é»˜è®¤æ—¥æœŸ
      const today = getCurrentDate();
      const nextMonth = formatDate(new Date(Date.now() + 30 * 24 * 60 * 60 * 1000));
      document.getElementById('startDate').value = today;
      document.getElementById('endDate').value = nextMonth;

      // åŠ è½½ä¿å­˜çš„æ•°æ®
      loadDraft();

      // ç›‘å¬è¾“å…¥å˜åŒ–
      document.getElementById('campaignName').addEventListener('input', debounce(updatePreview, 300));
      document.getElementById('dailyBudget').addEventListener('input', debounce(validateBudget, 300));

      // é¢„ç®—ç±»å‹åˆ‡æ¢
      document.querySelectorAll('input[name="budgetType"]').forEach(radio => {
        radio.addEventListener('change', function() {
          document.getElementById('budgetInput').style.display =
            this.value === 'daily' ? 'flex' : 'none';
        });
      });

      // åˆå§‹é¢„è§ˆ
      updatePreview();
    });

    // æ›´æ–°é¢„è§ˆ
    function updatePreview() {
      const nameTemplate = document.getElementById('campaignName').value;
      if (nameTemplate.includes('{')) {
        const preview = replaceVariables(nameTemplate, {
          'åŸå¸‚': 'åŒ—äº¬',
          'äº§å“': 'æ‰‹æœº',
          'æ—¥æœŸ': getCurrentDate(),
          'åºå·': '001'
        });
        document.getElementById('namePreview').style.display = 'flex';
        document.getElementById('namePreviewText').textContent = preview;
      } else {
        document.getElementById('namePreview').style.display = 'none';
      }
    }

    // éªŒè¯é¢„ç®—
    function validateBudget() {
      const budget = document.getElementById('dailyBudget').value;
      const budgetInput = document.getElementById('dailyBudget');

      if (budget && parseFloat(budget) < 100) {
        budgetInput.classList.add('error');
        Message.warning('æ—¥é¢„ç®—ä¸èƒ½ä½äº100å…ƒ');
      } else {
        budgetInput.classList.remove('error');
      }
    }

    // æ˜¾ç¤ºå˜é‡é€‰æ‹©å™¨
    function showVariableSelector() {
      if (variableModal) {
        variableModal.show();
      }
    }

    // éšè—å˜é‡é€‰æ‹©å™¨
    function hideVariableSelector() {
      if (variableModal) {
        variableModal.hide();
      }
    }

    // æ’å…¥å˜é‡
    function insertVariable(variable) {
      const input = document.getElementById('campaignName');
      const cursorPos = input.selectionStart;
      const textBefore = input.value.substring(0, cursorPos);
      const textAfter = input.value.substring(cursorPos);
      input.value = textBefore + variable + textAfter;
      input.focus();
      input.selectionStart = input.selectionEnd = cursorPos + variable.length;
      updatePreview();
      hideVariableSelector();
    }

    // åˆ‡æ¢é«˜çº§è®¾ç½®
    function toggleAdvanced() {
      const settings = document.getElementById('advancedSettings');
      const icon = document.getElementById('advancedIcon');
      if (settings.style.display === 'none') {
        settings.style.display = 'block';
        icon.style.transform = 'rotate(180deg)';
      } else {
        settings.style.display = 'none';
        icon.style.transform = 'rotate(0deg)';
      }
    }

    // ä¿å­˜è‰ç¨¿
    function saveDraft() {
      const data = {
        campaignName: document.getElementById('campaignName').value,
        budgetType: document.querySelector('input[name="budgetType"]:checked').value,
        dailyBudget: document.getElementById('dailyBudget').value,
        schedule: document.querySelector('input[name="schedule"]:checked').value,
        startDate: document.getElementById('startDate').value,
        endDate: document.getElementById('endDate').value
      };

      DataStore.save('campaignConfig', data);
      Message.success('è‰ç¨¿å·²ä¿å­˜');
    }

    // åŠ è½½è‰ç¨¿
    function loadDraft() {
      const data = DataStore.load('campaignConfig');
      if (data) {
        document.getElementById('campaignName').value = data.campaignName || '{åŸå¸‚}-{äº§å“}æ¨å¹¿-{æ—¥æœŸ}';
        if (data.budgetType) {
          document.querySelector(`input[name="budgetType"][value="${data.budgetType}"]`).checked = true;
        }
        if (data.dailyBudget) {
          document.getElementById('dailyBudget').value = data.dailyBudget;
        }
        if (data.schedule) {
          document.querySelector(`input[name="schedule"][value="${data.schedule}"]`).checked = true;
        }
        if (data.startDate) {
          document.getElementById('startDate').value = data.startDate;
        }
        if (data.endDate) {
          document.getElementById('endDate').value = data.endDate;
        }
        updatePreview();
      }
    }

    // ä¸‹ä¸€æ­¥
    function nextStep() {
      // éªŒè¯è¡¨å•
      const campaignName = document.getElementById('campaignName').value;
      const startDate = document.getElementById('startDate').value;
      const endDate = document.getElementById('endDate').value;
      const budgetType = document.querySelector('input[name="budgetType"]:checked').value;
      const dailyBudget = document.getElementById('dailyBudget').value;

      if (!campaignName.trim()) {
        Message.error('è¯·è¾“å…¥è®¡åˆ’åç§°è§„åˆ™');
        return;
      }

      if (!startDate || !endDate) {
        Message.error('è¯·é€‰æ‹©æŠ•æ”¾æ—¥æœŸ');
        return;
      }

      if (budgetType === 'daily' && (!dailyBudget || parseFloat(dailyBudget) < 100)) {
        Message.error('æ—¥é¢„ç®—ä¸èƒ½ä½äº100å…ƒ');
        return;
      }

      // ä¿å­˜å¹¶è·³è½¬
      saveDraft();
      Message.success('å¹¿å‘Šè®¡åˆ’é…ç½®å®Œæˆ');
      setTimeout(() => {
        window.location.href = 'config-adgroup.html';
      }, 500);
    }

    // è¿”å›ä¸Šä¸€æ­¥
    function goBack() {
      if (confirm('è¿”å›ä¸Šä¸€æ­¥å°†ä¸ä¿å­˜å½“å‰é…ç½®ï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ')) {
        window.location.href = 'index.html';
      }
    }
  </script>
</body>
</html>
