<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Step 2: é€‰æ‹©ç´ æå’Œå°è¯´æ ‡ç­¾ - æ™ºèƒ½æ‰¹é‡åˆ›ç¼–</title>
  <link rel="stylesheet" href="css/style.css">
  <style>
    .tag-selection-container {
      display: flex;
      gap: var(--space-6);
      min-height: calc(100vh - 64px - 100px);
    }

    .tag-left {
      flex: 1;
      max-width: 800px;
    }

    .tag-right {
      width: 320px;
      position: sticky;
      top: var(--space-6);
      height: fit-content;
    }

    .tag-section {
      background: var(--white);
      border-radius: var(--radius-lg);
      padding: var(--space-6);
      margin-bottom: var(--space-4);
    }

    .tag-section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: var(--space-5);
    }

    .tag-section-title {
      font-size: 18px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: var(--space-2);
    }

    .tag-section-badge {
      font-size: 14px;
      color: var(--primary-6);
      font-weight: 500;
    }

    .tag-category-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--heading);
      margin-bottom: var(--space-3);
      display: flex;
      align-items: center;
      gap: var(--space-2);
    }

    .tag-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: var(--space-3);
      margin-bottom: var(--space-3);
    }

    .tag-button {
      border: 2px solid var(--gray-3);
      border-radius: var(--radius-md);
      padding: var(--space-4) var(--space-3);
      text-align: center;
      cursor: pointer;
      transition: all var(--transition-base);
      background: var(--white);
    }

    .tag-button:hover {
      border-color: var(--primary-5);
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .tag-button.selected {
      border-color: var(--primary-6);
      background: var(--primary-1);
    }

    .tag-button-icon {
      font-size: 24px;
      margin-bottom: var(--space-2);
    }

    .tag-button-name {
      font-size: 14px;
      font-weight: 600;
      color: var(--heading);
      margin-bottom: var(--space-1);
    }

    .tag-button-count {
      font-size: 12px;
      color: var(--secondary);
    }

    .tag-button.selected .tag-button-count {
      color: var(--primary-6);
      font-weight: 600;
    }

    .tag-card {
      border: 2px solid var(--gray-3);
      border-radius: var(--radius-lg);
      padding: var(--space-4);
      margin-bottom: var(--space-3);
      cursor: pointer;
      transition: all var(--transition-base);
    }

    .tag-card:hover {
      border-color: var(--primary-5);
      box-shadow: var(--shadow-md);
    }

    .tag-card.selected {
      border-color: var(--primary-6);
      background: var(--primary-1);
    }

    .tag-card-header {
      display: flex;
      align-items: flex-start;
      gap: var(--space-3);
      margin-bottom: var(--space-3);
    }

    .tag-card-checkbox {
      margin-top: 2px;
      cursor: pointer;
    }

    .tag-card-content {
      flex: 1;
    }

    .tag-card-name {
      font-size: 16px;
      font-weight: 600;
      color: var(--heading);
      margin-bottom: var(--space-2);
    }

    .tag-card-count {
      font-size: 14px;
      color: var(--primary-6);
      font-weight: 600;
      margin-bottom: var(--space-2);
    }

    .tag-card-desc {
      font-size: 13px;
      color: var(--secondary);
      line-height: 1.6;
    }

    .tag-card-tags {
      display: flex;
      flex-wrap: wrap;
      gap: var(--space-1);
      margin-top: var(--space-2);
    }

    .mini-tag {
      padding: 2px 8px;
      background: var(--gray-2);
      border-radius: var(--radius-sm);
      font-size: 11px;
      color: var(--text);
    }

    .recommend-box {
      background: linear-gradient(135deg, var(--blue-1) 0%, var(--purple-1) 100%);
      border: 1px solid var(--blue-3);
      border-radius: var(--radius-lg);
      padding: var(--space-4);
      margin-bottom: var(--space-4);
    }

    .recommend-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--heading);
      margin-bottom: var(--space-3);
      display: flex;
      align-items: center;
      gap: var(--space-2);
    }

    .recommend-item {
      padding: var(--space-2) var(--space-3);
      background: var(--white);
      border-radius: var(--radius-md);
      margin-bottom: var(--space-2);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .recommend-item:last-child {
      margin-bottom: 0;
    }

    .recommend-text {
      font-size: 13px;
      color: var(--text);
    }

    .preview-panel {
      background: var(--white);
      border-radius: var(--radius-lg);
      padding: var(--space-5);
    }

    .preview-section {
      margin-bottom: var(--space-5);
    }

    .preview-section:last-child {
      margin-bottom: 0;
    }

    .preview-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: var(--space-3);
      display: flex;
      align-items: center;
      gap: var(--space-2);
    }

    .preview-tag-list {
      margin-bottom: var(--space-3);
    }

    .preview-tag-item {
      padding: var(--space-2) 0;
      border-bottom: 1px dashed var(--gray-3);
    }

    .preview-tag-item:last-child {
      border-bottom: none;
    }

    .preview-tag-name {
      font-size: 13px;
      color: var(--text);
      margin-bottom: 2px;
    }

    .preview-tag-count {
      font-size: 12px;
      color: var(--secondary);
    }

    .preview-total {
      padding: var(--space-3);
      background: var(--gray-1);
      border-radius: var(--radius-md);
      text-align: center;
    }

    .preview-total-label {
      font-size: 12px;
      color: var(--secondary);
      margin-bottom: var(--space-1);
    }

    .preview-total-value {
      font-size: 24px;
      font-weight: 700;
      color: var(--primary-6);
    }

    .preview-total-unit {
      font-size: 14px;
      color: var(--text);
    }

    .estimate-box {
      background: linear-gradient(135deg, var(--primary-1) 0%, var(--primary-2) 100%);
      border: 1px solid var(--primary-3);
      border-radius: var(--radius-md);
      padding: var(--space-4);
      text-align: center;
    }

    .estimate-label {
      font-size: 12px;
      color: var(--secondary);
      margin-bottom: var(--space-1);
    }

    .estimate-value {
      font-size: 32px;
      font-weight: 700;
      color: var(--primary-6);
      line-height: 1;
    }

    .estimate-unit {
      font-size: 14px;
      color: var(--secondary);
      margin-top: var(--space-1);
    }

    .action-bar {
      display: flex;
      justify-content: space-between;
      margin-top: var(--space-6);
      padding: var(--space-4) var(--space-6);
      background: var(--white);
      border-radius: var(--radius-lg);
      position: sticky;
      bottom: var(--space-4);
      box-shadow: var(--shadow-lg);
    }

    .info-tip {
      padding: var(--space-3);
      background: var(--blue-1);
      border-left: 3px solid var(--blue-6);
      border-radius: var(--radius-sm);
      font-size: 13px;
      color: var(--text);
      margin-top: var(--space-3);
    }

    .steps-indicator {
      display: flex;
      justify-content: space-between;
      margin-bottom: var(--space-6);
      padding: var(--space-4);
      background: var(--white);
      border-radius: var(--radius-lg);
    }

    .step-item {
      flex: 1;
      text-align: center;
      position: relative;
    }

    .step-item:not(:last-child)::after {
      content: '';
      position: absolute;
      top: 15px;
      right: -50%;
      width: 100%;
      height: 2px;
      background: var(--gray-3);
      z-index: -1;
    }

    .step-item.active .step-number {
      background: var(--primary-6);
      color: var(--white);
    }

    .step-item.completed .step-number {
      background: var(--success-6);
      color: var(--white);
    }

    .step-item.completed:not(:last-child)::after {
      background: var(--success-3);
    }

    .step-number {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: var(--gray-3);
      color: var(--gray-6);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      margin-bottom: var(--space-2);
    }

    .step-label {
      font-size: 12px;
      color: var(--secondary);
    }

    .step-item.active .step-label {
      color: var(--primary-6);
      font-weight: 600;
    }

    .step-item.completed .step-label {
      color: var(--success-6);
    }
  </style>
</head>
<body>
  <div class="page-container">
    <!-- é¡µé¢å¤´éƒ¨ -->
    <div class="page-header">
      <h1 class="page-title">æ™ºèƒ½æ‰¹é‡åˆ›ç¼– - é€‰æ‹©æ ‡ç­¾</h1>
      <div class="flex gap-3">
        <button class="btn btn-default" onclick="goBack()">â† è¿”å›ä¸Šä¸€æ­¥</button>
        <button class="btn btn-default" onclick="saveAsDraft()">ğŸ’¾ ä¿å­˜è‰ç¨¿</button>
      </div>
    </div>

    <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ -->
    <div class="page-content">
      <div class="steps-indicator fade-in">
        <div class="step-item completed">
          <div class="step-number">âœ“</div>
          <div class="step-label">é€‰æ‹©æ ‡ç­¾</div>
        </div>
        <div class="step-item active">
          <div class="step-number">2</div>
          <div class="step-label">ç´ æ&å°è¯´</div>
        </div>
        <div class="step-item">
          <div class="step-number">3</div>
          <div class="step-label">é…ç½®è§„åˆ™</div>
        </div>
        <div class="step-item">
          <div class="step-number">4</div>
          <div class="step-label">é¢„è§ˆ&æäº¤</div>
        </div>
      </div>

      <div class="tag-selection-container">
        <!-- å·¦ä¾§ï¼šæ ‡ç­¾é€‰æ‹©åŒº -->
        <div class="tag-left">
          <!-- 3ï¸âƒ£ é€‰æ‹©ç´ ææ ‡ç­¾ -->
          <div class="tag-section slide-up">
            <div class="tag-section-header">
              <div class="tag-section-title">
                <span>3ï¸âƒ£</span>
                <span>é€‰æ‹©ç´ ææ ‡ç­¾</span>
                <span style="color: var(--error); font-size: 14px;">*</span>
              </div>
              <div class="tag-section-badge" id="materialBadge">å·²é€‰ 0 ä¸ªæ ‡ç­¾</div>
            </div>

            <div class="tag-category-title">ğŸ·ï¸ æŒ‰ç´ æç±»å‹</div>

            <div class="tag-grid">
              <div class="tag-button" data-tag-id="material_decompress" onclick="toggleButtonTag(this, 'material')">
                <div class="tag-button-icon">ğŸ“¹</div>
                <div class="tag-button-name">è§£å‹ç´ æ</div>
                <div class="tag-button-count">12,345ä¸ª</div>
              </div>

              <div class="tag-button" data-tag-id="material_scroll" onclick="toggleButtonTag(this, 'material')">
                <div class="tag-button-icon">ğŸ“±</div>
                <div class="tag-button-name">æ»šå±ç´ æ</div>
                <div class="tag-button-count">8,967ä¸ª</div>
              </div>

              <div class="tag-button" data-tag-id="material_adx" onclick="toggleButtonTag(this, 'material')">
                <div class="tag-button-icon">ğŸ¬</div>
                <div class="tag-button-name">ADXç´ æ</div>
                <div class="tag-button-count">5,432ä¸ª</div>
              </div>
            </div>

            <div class="tag-category-title" style="margin-top: var(--space-4);">ğŸ·ï¸ æŒ‰æ•ˆæœç­›é€‰</div>

            <div class="tag-card" data-tag-id="material_high_exposure" onclick="toggleTag(this, 'material')">
              <div class="tag-card-header">
                <input type="checkbox" class="tag-card-checkbox" onclick="event.stopPropagation()">
                <div class="tag-card-content">
                  <div class="tag-card-name">é«˜æ›å…‰ç´ æ</div>
                  <div class="tag-card-count">ğŸ“Š åŒ…å« 3,456 ä¸ªç´ æ</div>
                  <div class="tag-card-desc">è¿‘7å¤©æ›å…‰é‡ > 10ä¸‡ï¼Œé€‚åˆå¿«é€Ÿèµ·é‡</div>
                  <div class="tag-card-tags">
                    <span class="mini-tag">è§£å‹</span>
                    <span class="mini-tag">æ»šå±</span>
                    <span class="mini-tag">ADX</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="tag-card" data-tag-id="material_high_click" onclick="toggleTag(this, 'material')">
              <div class="tag-card-header">
                <input type="checkbox" class="tag-card-checkbox" onclick="event.stopPropagation()">
                <div class="tag-card-content">
                  <div class="tag-card-name">é«˜ç‚¹å‡»ç´ æ</div>
                  <div class="tag-card-count">ğŸ“Š åŒ…å« 2,341 ä¸ªç´ æ</div>
                  <div class="tag-card-desc">ç‚¹å‡»ç‡ > 5%ï¼Œç”¨æˆ·äº’åŠ¨æ€§å¼º</div>
                  <div class="tag-card-tags">
                    <span class="mini-tag">è§£å‹</span>
                    <span class="mini-tag">æ»šå±</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="tag-card" data-tag-id="material_new" onclick="toggleTag(this, 'material')">
              <div class="tag-card-header">
                <input type="checkbox" class="tag-card-checkbox" onclick="event.stopPropagation()">
                <div class="tag-card-content">
                  <div class="tag-card-name">æ–°ç´ æ</div>
                  <div class="tag-card-count">ğŸ“Š åŒ…å« 1,234 ä¸ªç´ æ</div>
                  <div class="tag-card-desc">ä¸Šä¼  < 3å¤©ï¼Œæµ‹è¯•æ–°åˆ›æ„</div>
                  <div class="tag-card-tags">
                    <span class="mini-tag">è§£å‹</span>
                    <span class="mini-tag">æ»šå±</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="info-tip">
              ğŸ’¡ <strong>ç´ æåˆ†é…ç­–ç•¥ï¼š</strong>ç³»ç»Ÿå°†æ ¹æ®ä»¥ä¸‹ä¼˜å…ˆçº§è‡ªåŠ¨åˆ†é…ç´ æï¼š<br>
              1ï¸âƒ£ æŒ‰é€‰æ‹©çš„æ ‡ç­¾ç­›é€‰ç´ æ<br>
              2ï¸âƒ£ ä¼˜å…ˆä½¿ç”¨è¿‘æœŸæ•ˆæœå¥½çš„ç´ æ<br>
              3ï¸âƒ£ è‡ªåŠ¨å»é‡ï¼Œé¿å…é‡å¤ä½¿ç”¨
            </div>
          </div>

          <!-- 4ï¸âƒ£ é€‰æ‹©å°è¯´æ ‡ç­¾ -->
          <div class="tag-section slide-up" style="animation-delay: 0.1s;">
            <div class="tag-section-header">
              <div class="tag-section-title">
                <span>4ï¸âƒ£</span>
                <span>é€‰æ‹©å°è¯´æ ‡ç­¾</span>
                <span style="color: var(--error); font-size: 14px;">*</span>
              </div>
              <div class="tag-section-badge" id="bookBadge">å·²é€‰ 0 ä¸ªæ ‡ç­¾</div>
            </div>

            <!-- æ™ºèƒ½æ¨è -->
            <div class="recommend-box">
              <div class="recommend-title">
                <span>ğŸ’¡</span>
                <span>æ™ºèƒ½æ¨è</span>
              </div>
              <div style="font-size: 13px; color: var(--secondary); margin-bottom: var(--space-3);">
                æ ¹æ®æ‚¨é€‰æ‹©çš„é¡¹ç›®æ ‡ç­¾ï¼Œç³»ç»Ÿæ¨èä»¥ä¸‹å°è¯´æ ‡ç­¾ï¼š
              </div>
              <div class="recommend-item">
                <div class="recommend-text">â­ éœ¸é“æ€»è£çˆ†æ¬¾å°è¯´ (89æœ¬)</div>
                <button class="btn btn-primary btn-small" onclick="quickSelect('book_badao_hot')">å¿«é€Ÿé€‰æ‹©</button>
              </div>
              <div class="recommend-item">
                <div class="recommend-text">â­ ç„å¹»ä¿®ä»™çƒ­é—¨å°è¯´ (67æœ¬)</div>
                <button class="btn btn-primary btn-small" onclick="quickSelect('book_xuanhuan_hot')">å¿«é€Ÿé€‰æ‹©</button>
              </div>
            </div>

            <div class="tag-category-title">ğŸ·ï¸ æŒ‰æ•ˆæœåˆ†ç±»</div>

            <div class="tag-card" data-tag-id="book_hot" onclick="toggleTag(this, 'book')">
              <div class="tag-card-header">
                <input type="checkbox" class="tag-card-checkbox" onclick="event.stopPropagation()">
                <div class="tag-card-content">
                  <div class="tag-card-name">çˆ†æ¬¾å°è¯´</div>
                  <div class="tag-card-count">ğŸ“Š åŒ…å« 234 æœ¬å°è¯´</div>
                  <div class="tag-card-desc">
                    è¿‘30å¤©ï¼šæ›å…‰ > 100ä¸‡ Â· ç‚¹å‡»ç‡ > 3%<br>
                    åŒ…å«é¢˜æï¼šéœ¸é“æ€»è£ã€ç©¿è¶Šé‡ç”Ÿã€éƒ½å¸‚è¨€æƒ…
                  </div>
                </div>
              </div>
            </div>

            <div class="tag-card" data-tag-id="book_high_conversion" onclick="toggleTag(this, 'book')">
              <div class="tag-card-header">
                <input type="checkbox" class="tag-card-checkbox" onclick="event.stopPropagation()">
                <div class="tag-card-content">
                  <div class="tag-card-name">é«˜è½¬åŒ–å°è¯´</div>
                  <div class="tag-card-count">ğŸ“Š åŒ…å« 156 æœ¬å°è¯´</div>
                  <div class="tag-card-desc">
                    è¿‘30å¤©ï¼šè½¬åŒ–ç‡ > 5% Â· ROI > 1.5<br>
                    åŒ…å«é¢˜æï¼šéƒ½å¸‚è¨€æƒ…ã€éœ¸é“æ€»è£
                  </div>
                </div>
              </div>
            </div>

            <div class="tag-card" data-tag-id="book_new" onclick="toggleTag(this, 'book')">
              <div class="tag-card-header">
                <input type="checkbox" class="tag-card-checkbox" onclick="event.stopPropagation()">
                <div class="tag-card-content">
                  <div class="tag-card-name">æ–°ä¸Šæ¶å°è¯´</div>
                  <div class="tag-card-count">ğŸ“Š åŒ…å« 189 æœ¬å°è¯´</div>
                  <div class="tag-card-desc">ä¸Šæ¶ < 7å¤©ï¼Œæµ‹è¯•æ–°å†…å®¹æ½œåŠ›</div>
                </div>
              </div>
            </div>

            <div class="tag-category-title" style="margin-top: var(--space-4);">ğŸ·ï¸ æŒ‰ä½œè€…åˆ†ç±»</div>

            <div class="tag-grid" style="grid-template-columns: repeat(2, 1fr);">
              <div class="tag-button" data-tag-id="book_top_author" onclick="toggleButtonTag(this, 'book')">
                <div class="tag-button-icon">â­</div>
                <div class="tag-button-name">å¤´éƒ¨ä½œè€…ä½œå“</div>
                <div class="tag-button-count">123æœ¬</div>
              </div>

              <div class="tag-button" data-tag-id="book_new_author" onclick="toggleButtonTag(this, 'book')">
                <div class="tag-button-icon">ğŸ†•</div>
                <div class="tag-button-name">æ–°äººä½œè€…ä½œå“</div>
                <div class="tag-button-count">234æœ¬</div>
              </div>
            </div>

            <div class="info-tip">
              ğŸ’¡ <strong>æç¤ºï¼š</strong>å·²é€‰æ‹© <span id="bookCount">0</span> ä¸ªå°è¯´æ ‡ç­¾ï¼ŒåŒ¹é… <span id="bookMatchCount">0</span> æœ¬å°è¯´ã€‚
            </div>
          </div>
        </div>

        <!-- å³ä¾§ï¼šå®æ—¶é¢„è§ˆ -->
        <div class="tag-right">
          <div class="preview-panel">
            <div class="preview-section">
              <div class="preview-title">
                <span>ğŸ“Š</span>
                <span>æ ‡ç­¾åŒ¹é…æ±‡æ€»</span>
              </div>

              <!-- ç´ ææ ‡ç­¾ -->
              <div style="margin-bottom: var(--space-4);">
                <div style="font-size: 13px; font-weight: 600; color: var(--text); margin-bottom: var(--space-2);">
                  ç´ ææ ‡ç­¾: <span id="previewMaterialTagCount">0</span> ä¸ª
                </div>
                <div class="preview-tag-list" id="previewMaterialTags">
                  <div style="font-size: 13px; color: var(--secondary);">æš‚æ— é€‰æ‹©</div>
                </div>
                <div class="preview-total">
                  <div class="preview-total-label">åŒ¹é…ç´ æ</div>
                  <div class="preview-total-value" id="previewMaterialTotal">0</div>
                  <div class="preview-total-unit">ä¸ª</div>
                </div>
              </div>

              <!-- å°è¯´æ ‡ç­¾ -->
              <div style="margin-bottom: var(--space-4);">
                <div style="font-size: 13px; font-weight: 600; color: var(--text); margin-bottom: var(--space-2);">
                  å°è¯´æ ‡ç­¾: <span id="previewBookTagCount">0</span> ä¸ª
                </div>
                <div class="preview-tag-list" id="previewBookTags">
                  <div style="font-size: 13px; color: var(--secondary);">æš‚æ— é€‰æ‹©</div>
                </div>
                <div class="preview-total">
                  <div class="preview-total-label">åŒ¹é…å°è¯´</div>
                  <div class="preview-total-value" id="previewBookTotal">0</div>
                  <div class="preview-total-unit">æœ¬</div>
                </div>
              </div>

              <!-- ä¸Šä¸€æ­¥æ•°æ®æ‘˜è¦ -->
              <div style="padding: var(--space-3); background: var(--gray-1); border-radius: var(--radius-md); font-size: 12px; color: var(--secondary);">
                <div>ä¸»ä½“: <span id="prevSubjectCount">0</span> ä¸ª</div>
                <div>é¡¹ç›®: <span id="prevProjectCount">0</span> ä¸ª</div>
              </div>
            </div>

            <div class="preview-section">
              <div class="preview-title">
                <span>ğŸ’¡</span>
                <span>ç”Ÿæˆé¢„ä¼°</span>
              </div>

              <div class="estimate-box">
                <div class="estimate-label">æ ¹æ®æ‰€æœ‰æ ‡ç­¾</div>
                <div class="estimate-value" id="estimatedCount">0</div>
                <div class="estimate-unit">æ¡å¹¿å‘Šè®¡åˆ’</div>
              </div>

              <div style="margin-top: var(--space-3); font-size: 12px; color: var(--secondary); text-align: center;">
                âš ï¸ å…·ä½“æ•°é‡éœ€åœ¨ä¸‹ä¸€æ­¥é…ç½®è§„åˆ™åç¡®å®š
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- æ“ä½œæ  -->
      <div class="action-bar">
        <button class="btn btn-default" onclick="goBack()">â† è¿”å›ä¸Šä¸€æ­¥</button>
        <button class="btn btn-primary" id="nextBtn" disabled onclick="nextStep()">
          ä¸‹ä¸€æ­¥ï¼šé…ç½®ç”Ÿæˆè§„åˆ™ â†’
        </button>
      </div>
    </div>
  </div>

  <script src="js/main.js"></script>
  <script>
    // æ ‡ç­¾æ•°æ®
    const tagData = {
      material_decompress: { name: 'è§£å‹ç´ æ', count: 12345 },
      material_scroll: { name: 'æ»šå±ç´ æ', count: 8967 },
      material_adx: { name: 'ADXç´ æ', count: 5432 },
      material_high_exposure: { name: 'é«˜æ›å…‰ç´ æ', count: 3456 },
      material_high_click: { name: 'é«˜ç‚¹å‡»ç´ æ', count: 2341 },
      material_new: { name: 'æ–°ç´ æ', count: 1234 },
      book_hot: { name: 'çˆ†æ¬¾å°è¯´', count: 234 },
      book_high_conversion: { name: 'é«˜è½¬åŒ–å°è¯´', count: 156 },
      book_new: { name: 'æ–°ä¸Šæ¶å°è¯´', count: 189 },
      book_top_author: { name: 'å¤´éƒ¨ä½œè€…ä½œå“', count: 123 },
      book_new_author: { name: 'æ–°äººä½œè€…ä½œå“', count: 234 },
      book_badao_hot: { name: 'éœ¸é“æ€»è£çˆ†æ¬¾', count: 89 },
      book_xuanhuan_hot: { name: 'ç„å¹»ä¿®ä»™çƒ­é—¨', count: 67 }
    };

    // é€‰ä¸­çš„æ ‡ç­¾
    const selectedTags = {
      material: [],
      book: []
    };

    // ä¸Šä¸€æ­¥çš„æ•°æ®
    let prevStepData = {};

    // åˆ‡æ¢æ ‡ç­¾ï¼ˆè¯¦ç»†å¡ç‰‡ï¼‰
    function toggleTag(element, type) {
      const tagId = element.getAttribute('data-tag-id');
      const checkbox = element.querySelector('.tag-card-checkbox');

      if (element.classList.contains('selected')) {
        element.classList.remove('selected');
        checkbox.checked = false;
        selectedTags[type] = selectedTags[type].filter(id => id !== tagId);
      } else {
        element.classList.add('selected');
        checkbox.checked = true;
        selectedTags[type].push(tagId);
      }

      updatePreview();
      validateForm();
    }

    // åˆ‡æ¢æ ‡ç­¾ï¼ˆæŒ‰é’®å¼ï¼‰
    function toggleButtonTag(element, type) {
      const tagId = element.getAttribute('data-tag-id');

      if (element.classList.contains('selected')) {
        element.classList.remove('selected');
        selectedTags[type] = selectedTags[type].filter(id => id !== tagId);
      } else {
        element.classList.add('selected');
        selectedTags[type].push(tagId);
      }

      updatePreview();
      validateForm();
    }

    // å¿«é€Ÿé€‰æ‹©
    function quickSelect(tagId) {
      const element = document.querySelector(`[data-tag-id="${tagId}"]`);
      if (element) {
        toggleTag(element, 'book');
      } else {
        // å¦‚æœå…ƒç´ ä¸å­˜åœ¨ï¼Œç›´æ¥æ·»åŠ 
        selectedTags.book.push(tagId);
        updatePreview();
        validateForm();
      }
      Message.success('å·²å¿«é€Ÿé€‰æ‹©è¯¥æ ‡ç­¾');
    }

    // æ›´æ–°é¢„è§ˆ
    function updatePreview() {
      // æ›´æ–°ç´ ææ ‡ç­¾
      const materialTagCount = selectedTags.material.length;
      let materialTotalCount = 0;

      document.getElementById('materialBadge').textContent = `å·²é€‰ ${materialTagCount} ä¸ªæ ‡ç­¾`;
      document.getElementById('previewMaterialTagCount').textContent = materialTagCount;

      if (materialTagCount > 0) {
        let html = '';
        selectedTags.material.forEach(tagId => {
          const tag = tagData[tagId];
          if (tag) {
            materialTotalCount += tag.count;
            html += `
              <div class="preview-tag-item">
                <div class="preview-tag-name">â”œâ”€ ${tag.name}</div>
                <div class="preview-tag-count">${tag.count}ä¸ªç´ æ</div>
              </div>
            `;
          }
        });
        document.getElementById('previewMaterialTags').innerHTML = html;
      } else {
        document.getElementById('previewMaterialTags').innerHTML = '<div style="font-size: 13px; color: var(--secondary);">æš‚æ— é€‰æ‹©</div>';
      }

      const uniqueMaterialCount = materialTagCount > 0 ? Math.floor(materialTotalCount * 0.6) : 0;
      document.getElementById('previewMaterialTotal').textContent = uniqueMaterialCount;

      // æ›´æ–°å°è¯´æ ‡ç­¾
      const bookTagCount = selectedTags.book.length;
      let bookTotalCount = 0;

      document.getElementById('bookBadge').textContent = `å·²é€‰ ${bookTagCount} ä¸ªæ ‡ç­¾`;
      document.getElementById('bookCount').textContent = bookTagCount;
      document.getElementById('previewBookTagCount').textContent = bookTagCount;

      if (bookTagCount > 0) {
        let html = '';
        selectedTags.book.forEach(tagId => {
          const tag = tagData[tagId];
          if (tag) {
            bookTotalCount += tag.count;
            html += `
              <div class="preview-tag-item">
                <div class="preview-tag-name">â”œâ”€ ${tag.name}</div>
                <div class="preview-tag-count">${tag.count}æœ¬å°è¯´</div>
              </div>
            `;
          }
        });
        document.getElementById('previewBookTags').innerHTML = html;
      } else {
        document.getElementById('previewBookTags').innerHTML = '<div style="font-size: 13px; color: var(--secondary);">æš‚æ— é€‰æ‹©</div>';
      }

      const uniqueBookCount = bookTagCount > 0 ? Math.floor(bookTotalCount * 0.8) : 0;
      document.getElementById('bookMatchCount').textContent = uniqueBookCount;
      document.getElementById('previewBookTotal').textContent = uniqueBookCount;

      // æ›´æ–°é¢„ä¼°æ•°é‡ï¼ˆç®€åŒ–è®¡ç®—ï¼‰
      const subjectCount = prevStepData.subjectCount || 0;
      const projectCount = prevStepData.projectCount || 0;
      let estimatedCount = 0;

      if (subjectCount && projectCount && uniqueBookCount) {
        // ç®€åŒ–ï¼šä¸»ä½“æ•° Ã— é¡¹ç›®æ•° Ã— å°è¯´æ•° / 100
        estimatedCount = Math.floor(subjectCount * projectCount * uniqueBookCount / 100);
      }

      document.getElementById('estimatedCount').textContent = estimatedCount;
    }

    // è¡¨å•éªŒè¯
    function validateForm() {
      const isValid = selectedTags.material.length > 0 && selectedTags.book.length > 0;
      document.getElementById('nextBtn').disabled = !isValid;
    }

    // è¿”å›
    function goBack() {
      window.location.href = 'tag-selection-step1.html';
    }

    // ä¿å­˜è‰ç¨¿
    function saveAsDraft() {
      DataStore.save('selectedTags_step2', selectedTags);
      Message.success('è‰ç¨¿å·²ä¿å­˜');
    }

    // ä¸‹ä¸€æ­¥
    function nextStep() {
      if (selectedTags.material.length === 0 || selectedTags.book.length === 0) {
        Message.error('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªç´ ææ ‡ç­¾å’Œä¸€ä¸ªå°è¯´æ ‡ç­¾');
        return;
      }

      // åˆå¹¶æ‰€æœ‰æ ‡ç­¾
      const allTags = {
        ...DataStore.load('selectedTags_step1'),
        ...selectedTags
      };

      DataStore.save('selectedTags_all', allTags);
      Message.success('æ ‡ç­¾å·²ä¿å­˜ï¼Œè¿›å…¥è§„åˆ™é…ç½®...');

      setTimeout(() => {
        window.location.href = 'tag-rule-config.html';
      }, 500);
    }

    // é¡µé¢åŠ è½½æ—¶æ¢å¤æ•°æ®
    window.addEventListener('DOMContentLoaded', () => {
      // åŠ è½½ä¸Šä¸€æ­¥æ•°æ®
      const step1Data = DataStore.load('selectedTags_step1');
      if (step1Data) {
        const subjectCount = step1Data.subject ? step1Data.subject.length * 20 : 0;
        const projectCount = step1Data.project ? step1Data.project.length * 100 : 0;

        prevStepData = { subjectCount, projectCount };

        document.getElementById('prevSubjectCount').textContent = subjectCount;
        document.getElementById('prevProjectCount').textContent = projectCount;
      }

      // åŠ è½½è‰ç¨¿
      const savedTags = DataStore.load('selectedTags_step2');
      if (savedTags) {
        selectedTags.material = savedTags.material || [];
        selectedTags.book = savedTags.book || [];

        // æ¢å¤é€‰ä¸­çŠ¶æ€
        selectedTags.material.forEach(tagId => {
          const element = document.querySelector(`[data-tag-id="${tagId}"]`);
          if (element) {
            element.classList.add('selected');
            const checkbox = element.querySelector('.tag-card-checkbox');
            if (checkbox) checkbox.checked = true;
          }
        });

        selectedTags.book.forEach(tagId => {
          const element = document.querySelector(`[data-tag-id="${tagId}"]`);
          if (element) {
            element.classList.add('selected');
            const checkbox = element.querySelector('.tag-card-checkbox');
            if (checkbox) checkbox.checked = true;
          }
        });

        updatePreview();
        validateForm();
      }
    });
  </script>
</body>
</html>
