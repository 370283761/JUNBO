<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é…ç½®ç”Ÿæˆè§„åˆ™ - å¹¿å‘Šæ‰¹é‡åˆ›ç¼–</title>
  <link rel="stylesheet" href="css/style.css">
  <style>
    .config-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px;
      display: grid;
      grid-template-columns: 800px 1fr;
      gap: 24px;
      align-items: start;
    }

    .config-main {
      background: var(--white);
      border-radius: var(--radius-lg);
      padding: 32px;
    }

    .section {
      margin-bottom: 32px;
    }

    .section-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--heading);
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .mode-selector {
      display: flex;
      gap: 16px;
      margin-bottom: 24px;
    }

    .mode-option {
      flex: 1;
      padding: 20px;
      border: 2px solid var(--gray-3);
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: all var(--transition-base);
    }

    .mode-option:hover {
      border-color: var(--primary-6);
    }

    .mode-option.active {
      border-color: var(--primary-6);
      background: var(--primary-1);
    }

    .mode-option-title {
      font-weight: 600;
      color: var(--heading);
      margin-bottom: 4px;
    }

    .mode-option-desc {
      font-size: 12px;
      color: var(--secondary);
    }

    .template-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .template-card {
      padding: 16px;
      border: 1px solid var(--gray-3);
      border-radius: var(--radius-md);
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all var(--transition-base);
    }

    .template-card:hover {
      border-color: var(--primary-6);
      background: var(--primary-1);
    }

    .template-info h4 {
      font-size: 14px;
      font-weight: 600;
      color: var(--heading);
      margin-bottom: 4px;
    }

    .template-info p {
      font-size: 12px;
      color: var(--secondary);
      margin-bottom: 4px;
    }

    .template-info .estimate {
      font-size: 12px;
      color: var(--primary-6);
      font-weight: 600;
    }

    .rule-config {
      background: var(--gray-1);
      padding: 20px;
      border-radius: var(--radius-md);
      margin-top: 16px;
    }

    .form-row {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
    }

    .form-row label {
      font-size: 14px;
      color: var(--text);
      min-width: 120px;
    }

    .form-row input[type="number"] {
      width: 80px;
    }

    .checkbox-group {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .checkbox-item {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .sub-config {
      margin-left: 32px;
      margin-top: 8px;
      padding-left: 16px;
      border-left: 2px solid var(--gray-3);
    }

    .preview-panel {
      background: var(--white);
      border-radius: var(--radius-lg);
      padding: 24px;
      position: sticky;
      top: 24px;
    }

    .preview-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 16px;
      color: var(--heading);
    }

    .stat-item {
      display: flex;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 1px solid var(--gray-2);
    }

    .stat-item:last-child {
      border-bottom: none;
    }

    .stat-label {
      color: var(--secondary);
      font-size: 14px;
    }

    .stat-value {
      font-weight: 600;
      color: var(--heading);
    }

    .estimate-box {
      background: var(--primary-1);
      border: 1px solid var(--primary-3);
      border-radius: var(--radius-md);
      padding: 16px;
      margin-top: 16px;
      text-align: center;
    }

    .estimate-label {
      font-size: 12px;
      color: var(--secondary);
      margin-bottom: 4px;
    }

    .estimate-value {
      font-size: 28px;
      font-weight: 700;
      color: var(--primary-6);
    }

    .action-bar {
      display: flex;
      justify-content: space-between;
      margin-top: 32px;
      padding-top: 24px;
      border-top: 1px solid var(--gray-2);
    }
  </style>
</head>
<body>
  <div class="page-container">
    <!-- é¡µé¢å¤´éƒ¨ -->
    <div class="page-header">
      <h1 class="page-title">é…ç½®ç”Ÿæˆè§„åˆ™</h1>
      <div class="flex gap-3">
        <button class="btn btn-default" onclick="goBack()">â† è¿”å›</button>
        <button class="btn btn-default" onclick="saveAsDraft()">ğŸ’¾ ä¿å­˜è‰ç¨¿</button>
      </div>
    </div>

    <!-- ä¸»è¦å†…å®¹ -->
    <div class="config-container fade-in">
      <!-- å·¦ä¾§é…ç½®åŒº -->
      <div class="config-main">
        <!-- è§„åˆ™æ¨¡å¼é€‰æ‹© -->
        <div class="section">
          <div class="section-title">
            <span>1ï¸âƒ£</span>
            <span>é€‰æ‹©è§„åˆ™æ¨¡å¼</span>
          </div>
          <div class="mode-selector">
            <div class="mode-option active" id="modeFullCombination" onclick="selectMode('full-combination')">
              <div class="mode-option-title">â—‰ å…¨é‡ç»„åˆ</div>
              <div class="mode-option-desc">æ ¹æ®ç»´åº¦è‡ªåŠ¨ç»„åˆç”Ÿæˆ</div>
            </div>
            <div class="mode-option" id="modeCustom" onclick="selectMode('custom')">
              <div class="mode-option-title">â—‹ è‡ªå®šä¹‰è§„åˆ™</div>
              <div class="mode-option-desc">çµæ´»é…ç½®ç”Ÿæˆæ¡ä»¶</div>
            </div>
          </div>
        </div>

        <!-- è§„åˆ™æ¨¡æ¿ -->
        <div class="section">
          <div class="section-title">
            <span>âš¡</span>
            <span>å¸¸ç”¨è§„åˆ™æ¨¡æ¿</span>
          </div>
          <div class="template-list">
            <div class="template-card">
              <div class="template-info">
                <h4>è§„åˆ™æ¨¡æ¿1ï¼šå…¨é‡ç»„åˆ</h4>
                <p>6ä¸ªä¸»ä½“ Ã— 4é¡¹ç›®/ä¸»ä½“ Ã— 4å¹¿å‘Š/é¡¹ç›® Ã— 4ç´ æ/å¹¿å‘Š</p>
                <p class="estimate">é¢„è®¡ç”Ÿæˆï¼š384 æ¡å¹¿å‘Š</p>
              </div>
              <button class="btn btn-primary btn-small" onclick="useTemplate('template1')">ä½¿ç”¨æ¨¡æ¿</button>
            </div>

            <div class="template-card">
              <div class="template-info">
                <h4>è§„åˆ™æ¨¡æ¿2ï¼šè·‘é‡ä¸»ä½“+è½¬åŒ–>6</h4>
                <p>æ¯è´¦æˆ·6å¹¿å‘Šï¼ˆ3è§£å‹+3æ»šå±ï¼‰</p>
                <p class="estimate">é¢„è®¡ç”Ÿæˆï¼šæ ¹æ®ç­›é€‰è´¦æˆ·æ•°</p>
              </div>
              <button class="btn btn-primary btn-small" onclick="useTemplate('template2')">ä½¿ç”¨æ¨¡æ¿</button>
            </div>

            <div class="template-card">
              <div class="template-info">
                <h4>è§„åˆ™æ¨¡æ¿3ï¼šè·‘é‡ä¸»ä½“+è½¬åŒ–>6+å¼€æˆ·<5å¤©</h4>
                <p>æ¯è´¦æˆ·6å¹¿å‘Šï¼ˆ3è§£å‹ADX+è‡ªå‰ªè¾‘+3æ»šå±ï¼‰</p>
                <p class="estimate">é¢„è®¡ç”Ÿæˆï¼šæ ¹æ®ç­›é€‰è´¦æˆ·æ•°</p>
              </div>
              <button class="btn btn-primary btn-small" onclick="useTemplate('template3')">ä½¿ç”¨æ¨¡æ¿</button>
            </div>
          </div>
        </div>

        <!-- å…¨é‡ç»„åˆé…ç½® -->
        <div class="section" id="fullCombinationConfig">
          <div class="section-title">
            <span>2ï¸âƒ£</span>
            <span>å…¨é‡ç»„åˆé…ç½®</span>
          </div>
          <div class="rule-config">
            <div class="form-row">
              <label>æ¯ä¸ªä¸»ä½“ä¸‹é¡¹ç›®æ•°ï¼š</label>
              <input type="number" id="projectsPerSubject" value="4" min="1" max="10" onchange="updateEstimate()">
              <span class="text-secondary">ä¸ª</span>
            </div>
            <div class="form-row">
              <label>æ¯ä¸ªé¡¹ç›®ä¸‹å¹¿å‘Šæ•°ï¼š</label>
              <input type="number" id="adsPerProject" value="4" min="1" max="10" onchange="updateEstimate()">
              <span class="text-secondary">ä¸ª</span>
            </div>
            <div class="form-row">
              <label>æ¯ä¸ªå¹¿å‘Šä¸‹ç´ ææ•°ï¼š</label>
              <input type="number" id="materialsPerAd" value="4" min="1" max="10" onchange="updateEstimate()">
              <span class="text-secondary">ä¸ª</span>
            </div>
          </div>
        </div>

        <!-- è‡ªå®šä¹‰è§„åˆ™é…ç½® -->
        <div class="section" id="customRuleConfig" style="display: none;">
          <div class="section-title">
            <span>2ï¸âƒ£</span>
            <span>è‡ªå®šä¹‰è§„åˆ™é…ç½®</span>
          </div>

          <!-- ç­›é€‰æ¡ä»¶ -->
          <div class="rule-config">
            <h4 style="margin-bottom: 16px; font-size: 14px; font-weight: 600;">ç­›é€‰æ¡ä»¶</h4>
            <div class="checkbox-group">
              <div class="checkbox-item">
                <input type="checkbox" id="condSubjectStatus" onchange="updateEstimate()">
                <label for="condSubjectStatus">ä¸»ä½“çŠ¶æ€ï¼š</label>
                <select id="subjectStatus" style="width: 120px;">
                  <option value="running">è·‘é‡</option>
                  <option value="testing">æµ‹è¯•</option>
                </select>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="condConversion" onchange="updateEstimate()">
                <label for="condConversion">è½¬åŒ–æ•°é‡ ></label>
                <input type="number" id="conversionMin" value="6" min="0" style="width: 80px;">
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="condOpenDays" onchange="updateEstimate()">
                <label for="condOpenDays">å¼€æˆ·å¤©æ•° <</label>
                <input type="number" id="openDaysMax" value="5" min="0" style="width: 80px;">
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="condAccountStatus" onchange="updateEstimate()">
                <label for="condAccountStatus">è´¦æˆ·çŠ¶æ€ï¼š</label>
                <select id="accountStatus" style="width: 120px;">
                  <option value="running">è·‘é‡</option>
                  <option value="testing">æµ‹è¯•</option>
                </select>
              </div>
            </div>
          </div>

          <!-- ç”Ÿæˆé…ç½® -->
          <div class="rule-config" style="margin-top: 16px;">
            <h4 style="margin-bottom: 16px; font-size: 14px; font-weight: 600;">ç”Ÿæˆé…ç½®</h4>
            <div class="form-row">
              <label>
                <input type="checkbox" id="perAccount" checked onchange="updateEstimate()">
                æŒ‰è´¦æˆ·ç”Ÿæˆ
              </label>
            </div>
            <div class="form-row">
              <label>æ¯ä¸ªè´¦æˆ·å¹¿å‘Šæ•°ï¼š</label>
              <input type="number" id="adCount" value="6" min="1" max="20" onchange="updateEstimate()">
              <span class="text-secondary">ä¸ª</span>
            </div>
            <div class="sub-config">
              <div class="form-row">
                <label>è§£å‹ç´ æï¼š</label>
                <input type="number" id="decompressCount" value="3" min="0" max="10" onchange="updateBreakdown()">
                <span class="text-secondary">ä¸ª</span>
              </div>
              <div class="form-row">
                <label>æ»šå±ç´ æï¼š</label>
                <input type="number" id="scrollCount" value="3" min="0" max="10" onchange="updateBreakdown()">
                <span class="text-secondary">ä¸ª</span>
              </div>
            </div>
          </div>

          <!-- ç´ æåˆ†é…ç­–ç•¥ -->
          <div class="rule-config" style="margin-top: 16px;">
            <h4 style="margin-bottom: 16px; font-size: 14px; font-weight: 600;">ç´ æåˆ†é…ç­–ç•¥</h4>

            <div style="margin-bottom: 16px;">
              <div style="font-weight: 600; margin-bottom: 8px;">è§£å‹ç´ æï¼š</div>
              <div class="checkbox-group">
                <div class="checkbox-item">
                  <input type="checkbox" id="decompressAdx">
                  <label for="decompressAdx">ADXæŒ‰æ›å…‰é™åºï¼š</label>
                  <input type="number" id="decompressAdxCount" value="1" min="0" max="5" style="width: 60px;">
                  <span class="text-secondary">ä¸ª</span>
                </div>
                <div class="checkbox-item">
                  <input type="checkbox" id="decompressSelfEdit">
                  <label for="decompressSelfEdit">è‡ªå‰ªè¾‘ç´ æï¼š</label>
                  <input type="number" id="decompressSelfEditCount" value="2" min="0" max="5" style="width: 60px;">
                  <span class="text-secondary">ä¸ª</span>
                </div>
              </div>
            </div>

            <div>
              <div style="font-weight: 600; margin-bottom: 8px;">æ»šå±ç´ æï¼š</div>
              <div class="checkbox-group">
                <div class="checkbox-item">
                  <input type="checkbox" id="scrollByClicks" checked>
                  <label for="scrollByClicks">æŒ‰ç‚¹å‡»é™åºï¼š</label>
                  <input type="number" id="scrollByClicksCount" value="3" min="0" max="5" style="width: 60px;">
                  <span class="text-secondary">ä¸ª</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- æ“ä½œæŒ‰é’® -->
        <div class="action-bar">
          <button class="btn btn-default" onclick="goBack()">â† ä¸Šä¸€æ­¥</button>
          <div class="flex gap-3">
            <button class="btn btn-default" onclick="saveAsDraft()">ä¿å­˜è‰ç¨¿</button>
            <button class="btn btn-primary" onclick="nextStep()">ä¸‹ä¸€æ­¥ï¼šé¢„è§ˆç»“æœ â†’</button>
          </div>
        </div>
      </div>

      <!-- å³ä¾§é¢„è§ˆé¢æ¿ -->
      <div class="preview-panel">
        <div class="preview-title">ğŸ“Š ç”Ÿæˆé¢„ä¼°</div>

        <div class="stat-item">
          <span class="stat-label">ä¸»ä½“æ•°é‡</span>
          <span class="stat-value" id="previewSubjects">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">è´¦æˆ·æ•°é‡</span>
          <span class="stat-value" id="previewAccounts">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">é¡¹ç›®æ•°é‡</span>
          <span class="stat-value" id="previewProjects">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">å°è¯´æ•°é‡</span>
          <span class="stat-value" id="previewBooks">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">ç´ ææ•°é‡</span>
          <span class="stat-value" id="previewMaterials">0</span>
        </div>

        <div class="estimate-box">
          <div class="estimate-label">é¢„è®¡ç”Ÿæˆå¹¿å‘Šè®¡åˆ’</div>
          <div class="estimate-value" id="estimatedCount">0</div>
          <div class="estimate-label">æ¡</div>
        </div>

        <div style="margin-top: 16px; padding: 12px; background: var(--warning-1); border-radius: var(--radius-md); font-size: 12px; color: var(--warning-7);">
          ğŸ’¡ æç¤ºï¼šä¿®æ”¹é…ç½®åä¼šå®æ—¶æ›´æ–°é¢„ä¼°æ•°é‡
        </div>
      </div>
    </div>
  </div>

  <script src="js/main.js"></script>
  <script src="js/generation-engine.js"></script>
  <script>
    let engine = new GenerationEngine();
    let currentMode = 'full-combination';
    let selectedDimensions = {};

    // åˆå§‹åŒ–
    function init() {
      // åŠ è½½é€‰ä¸­çš„ç»´åº¦æ•°æ®
      selectedDimensions = DataStore.load('selectedDimensions', {
        subjects: [],
        accounts: [],
        projects: [],
        books: [],
        materials: []
      });

      engine.setSelectedData(selectedDimensions);
      updatePreview();
      updateEstimate();
    }

    // æ›´æ–°é¢„è§ˆé¢æ¿
    function updatePreview() {
      document.getElementById('previewSubjects').textContent = selectedDimensions.subjects.length;
      document.getElementById('previewAccounts').textContent = selectedDimensions.accounts.length;
      document.getElementById('previewProjects').textContent = selectedDimensions.projects.length;
      document.getElementById('previewBooks').textContent = selectedDimensions.books.length;
      document.getElementById('previewMaterials').textContent = selectedDimensions.materials.length;
    }

    // é€‰æ‹©è§„åˆ™æ¨¡å¼
    function selectMode(mode) {
      currentMode = mode;

      // æ›´æ–°UI
      document.getElementById('modeFullCombination').classList.toggle('active', mode === 'full-combination');
      document.getElementById('modeCustom').classList.toggle('active', mode === 'custom');

      document.getElementById('modeFullCombination').querySelector('.mode-option-title').textContent =
        mode === 'full-combination' ? 'â—‰ å…¨é‡ç»„åˆ' : 'â—‹ å…¨é‡ç»„åˆ';
      document.getElementById('modeCustom').querySelector('.mode-option-title').textContent =
        mode === 'custom' ? 'â—‰ è‡ªå®šä¹‰è§„åˆ™' : 'â—‹ è‡ªå®šä¹‰è§„åˆ™';

      // æ˜¾ç¤º/éšè—é…ç½®åŒº
      document.getElementById('fullCombinationConfig').style.display =
        mode === 'full-combination' ? 'block' : 'none';
      document.getElementById('customRuleConfig').style.display =
        mode === 'custom' ? 'block' : 'none';

      updateEstimate();
    }

    // ä½¿ç”¨æ¨¡æ¿
    function useTemplate(templateId) {
      const template = window.RULE_TEMPLATES[templateId];
      if (!template) return;

      Message.success(`å·²åŠ è½½æ¨¡æ¿ï¼š${template.name}`);

      currentMode = template.mode;
      selectMode(currentMode);

      if (template.mode === 'full-combination') {
        document.getElementById('projectsPerSubject').value = template.generation.projectsPerSubject || 4;
        document.getElementById('adsPerProject').value = template.generation.adsPerProject || 4;
        document.getElementById('materialsPerAd').value = template.generation.materialsPerAd || 4;
      } else if (template.mode === 'custom') {
        // è®¾ç½®æ¡ä»¶
        if (template.conditions) {
          document.getElementById('condSubjectStatus').checked = !!template.conditions.subjectStatus;
          document.getElementById('subjectStatus').value = template.conditions.subjectStatus || 'running';

          document.getElementById('condConversion').checked = template.conditions.conversionMin !== undefined;
          document.getElementById('conversionMin').value = template.conditions.conversionMin || 6;

          document.getElementById('condOpenDays').checked = template.conditions.openDaysMax !== undefined;
          document.getElementById('openDaysMax').value = template.conditions.openDaysMax || 5;

          document.getElementById('condAccountStatus').checked = !!template.conditions.accountStatus;
          document.getElementById('accountStatus').value = template.conditions.accountStatus || 'running';
        }

        // è®¾ç½®ç”Ÿæˆé…ç½®
        if (template.generation) {
          document.getElementById('perAccount').checked = template.generation.perAccount || false;
          document.getElementById('adCount').value = template.generation.adCount || 6;

          if (template.generation.breakdown) {
            document.getElementById('decompressCount').value = template.generation.breakdown.decompress || 3;
            document.getElementById('scrollCount').value = template.generation.breakdown.scroll || 3;
          }

          // è®¾ç½®ç´ æç­–ç•¥
          if (template.generation.materialStrategy) {
            const decompressStrategy = template.generation.materialStrategy.decompress || [];
            const adxStrategy = decompressStrategy.find(s => s.source === 'adx');
            const selfEditStrategy = decompressStrategy.find(s => s.source === 'self-edit');

            if (adxStrategy) {
              document.getElementById('decompressAdx').checked = true;
              document.getElementById('decompressAdxCount').value = adxStrategy.count || 1;
            }
            if (selfEditStrategy) {
              document.getElementById('decompressSelfEdit').checked = true;
              document.getElementById('decompressSelfEditCount').value = selfEditStrategy.count || 2;
            }

            const scrollStrategy = template.generation.materialStrategy.scroll || [];
            if (scrollStrategy.length > 0) {
              document.getElementById('scrollByClicks').checked = true;
              document.getElementById('scrollByClicksCount').value = scrollStrategy[0].count || 3;
            }
          }
        }
      }

      updateEstimate();
    }

    // æ›´æ–°ç´ æåˆ†è§£
    function updateBreakdown() {
      const decompressCount = parseInt(document.getElementById('decompressCount').value) || 0;
      const scrollCount = parseInt(document.getElementById('scrollCount').value) || 0;
      const total = decompressCount + scrollCount;

      document.getElementById('adCount').value = total;
      updateEstimate();
    }

    // æ›´æ–°é¢„ä¼°æ•°é‡
    function updateEstimate() {
      const rules = buildRules();
      engine.setRules(rules);

      const count = engine.calculateCount();
      document.getElementById('estimatedCount').textContent = count;

      // æ›´æ–°ç­›é€‰åçš„è´¦æˆ·æ•°
      if (currentMode === 'custom') {
        const filteredAccounts = engine.filterAccounts();
        document.getElementById('previewAccounts').textContent = filteredAccounts.length;
      } else {
        document.getElementById('previewAccounts').textContent = selectedDimensions.accounts.length;
      }
    }

    // æ„å»ºè§„åˆ™å¯¹è±¡
    function buildRules() {
      if (currentMode === 'full-combination') {
        return {
          mode: 'full-combination',
          generation: {
            projectsPerSubject: parseInt(document.getElementById('projectsPerSubject').value) || 4,
            adsPerProject: parseInt(document.getElementById('adsPerProject').value) || 4,
            materialsPerAd: parseInt(document.getElementById('materialsPerAd').value) || 4
          }
        };
      } else {
        const conditions = {};

        if (document.getElementById('condSubjectStatus').checked) {
          conditions.subjectStatus = document.getElementById('subjectStatus').value;
        }
        if (document.getElementById('condConversion').checked) {
          conditions.conversionMin = parseInt(document.getElementById('conversionMin').value) || 0;
        }
        if (document.getElementById('condOpenDays').checked) {
          conditions.openDaysMax = parseInt(document.getElementById('openDaysMax').value) || 0;
        }
        if (document.getElementById('condAccountStatus').checked) {
          conditions.accountStatus = document.getElementById('accountStatus').value;
        }

        const materialStrategy = {
          decompress: [],
          scroll: []
        };

        if (document.getElementById('decompressAdx').checked) {
          materialStrategy.decompress.push({
            source: 'adx',
            sortBy: 'exposure',
            count: parseInt(document.getElementById('decompressAdxCount').value) || 1
          });
        }
        if (document.getElementById('decompressSelfEdit').checked) {
          materialStrategy.decompress.push({
            source: 'self-edit',
            count: parseInt(document.getElementById('decompressSelfEditCount').value) || 2
          });
        }
        if (document.getElementById('scrollByClicks').checked) {
          materialStrategy.scroll.push({
            sortBy: 'clicks',
            count: parseInt(document.getElementById('scrollByClicksCount').value) || 3
          });
        }

        return {
          mode: 'custom',
          conditions: conditions,
          generation: {
            perAccount: document.getElementById('perAccount').checked,
            adCount: parseInt(document.getElementById('adCount').value) || 6,
            breakdown: {
              decompress: parseInt(document.getElementById('decompressCount').value) || 3,
              scroll: parseInt(document.getElementById('scrollCount').value) || 3
            },
            materialStrategy: materialStrategy
          }
        };
      }
    }

    // è¿”å›ä¸Šä¸€æ­¥
    function goBack() {
      window.location.href = 'data-selection.html';
    }

    // ä¿å­˜è‰ç¨¿
    function saveAsDraft() {
      const rules = buildRules();
      DataStore.save('generationRules', rules);
      Message.success('è‰ç¨¿å·²ä¿å­˜');
    }

    // ä¸‹ä¸€æ­¥
    function nextStep() {
      const rules = buildRules();
      const count = engine.calculateCount();

      if (count === 0) {
        Message.error('é¢„è®¡ç”Ÿæˆæ•°é‡ä¸º0ï¼Œè¯·æ£€æŸ¥é…ç½®');
        return;
      }

      // ä¿å­˜è§„åˆ™
      DataStore.save('generationRules', rules);
      Message.success('è§„åˆ™é…ç½®å®Œæˆï¼Œæ­£åœ¨ç”Ÿæˆé¢„è§ˆ...');

      setTimeout(() => {
        window.location.href = 'preview-result.html';
      }, 500);
    }

    // é¡µé¢åŠ è½½å®Œæˆ
    window.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
