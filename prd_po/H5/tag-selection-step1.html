<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Step 1: é€‰æ‹©æ ‡ç­¾ - æ™ºèƒ½æ‰¹é‡åˆ›ç¼–</title>
  <link rel="stylesheet" href="css/style.css">
  <style>
    .tag-selection-container {
      display: flex;
      gap: var(--space-6);
      min-height: calc(100vh - 64px - 100px);
    }

    .tag-left {
      flex: 1;
      max-width: 800px;
    }

    .tag-right {
      width: 320px;
      position: sticky;
      top: var(--space-6);
      height: fit-content;
    }

    .tag-section {
      background: var(--white);
      border-radius: var(--radius-lg);
      padding: var(--space-6);
      margin-bottom: var(--space-4);
    }

    .tag-section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: var(--space-5);
    }

    .tag-section-title {
      font-size: 18px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: var(--space-2);
    }

    .tag-section-badge {
      font-size: 14px;
      color: var(--primary-6);
      font-weight: 500;
    }

    .tag-category-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--heading);
      margin-bottom: var(--space-3);
      display: flex;
      align-items: center;
      gap: var(--space-2);
    }

    /* è¯¦ç»†æ ‡ç­¾å¡ç‰‡ */
    .tag-card {
      border: 2px solid var(--gray-3);
      border-radius: var(--radius-lg);
      padding: var(--space-4);
      margin-bottom: var(--space-3);
      cursor: pointer;
      transition: all var(--transition-base);
      position: relative;
    }

    .tag-card:hover {
      border-color: var(--primary-5);
      box-shadow: var(--shadow-md);
    }

    .tag-card.selected {
      border-color: var(--primary-6);
      background: var(--primary-1);
    }

    .tag-card-header {
      display: flex;
      align-items: flex-start;
      gap: var(--space-3);
      margin-bottom: var(--space-3);
    }

    .tag-card-checkbox {
      margin-top: 2px;
      cursor: pointer;
    }

    .tag-card-content {
      flex: 1;
    }

    .tag-card-name {
      font-size: 16px;
      font-weight: 600;
      color: var(--heading);
      margin-bottom: var(--space-2);
    }

    .tag-card-count {
      font-size: 14px;
      color: var(--primary-6);
      font-weight: 600;
      margin-bottom: var(--space-3);
    }

    .tag-card-rules {
      font-size: 13px;
      color: var(--secondary);
      line-height: 1.6;
    }

    .tag-card-rules-title {
      font-weight: 600;
      color: var(--text);
      margin-bottom: var(--space-1);
    }

    .tag-card-rule-item {
      margin-left: var(--space-3);
      padding-left: var(--space-2);
      border-left: 2px solid var(--gray-3);
    }

    .tag-card-footer {
      margin-top: var(--space-3);
      padding-top: var(--space-3);
      border-top: 1px solid var(--gray-2);
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 12px;
    }

    .tag-card-dynamic {
      color: var(--success-6);
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .tag-card-time {
      color: var(--secondary);
    }

    .tag-card-actions {
      display: none;
    }

    .tag-card:hover .tag-card-actions {
      display: flex;
      gap: var(--space-2);
    }

    /* æŒ‰é’®å¼æ ‡ç­¾ï¼ˆç”¨äºé¢˜æåˆ†ç±»ï¼‰ */
    .tag-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: var(--space-3);
      margin-bottom: var(--space-3);
    }

    .tag-button {
      border: 2px solid var(--gray-3);
      border-radius: var(--radius-md);
      padding: var(--space-4) var(--space-3);
      text-align: center;
      cursor: pointer;
      transition: all var(--transition-base);
      background: var(--white);
    }

    .tag-button:hover {
      border-color: var(--primary-5);
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .tag-button.selected {
      border-color: var(--primary-6);
      background: var(--primary-1);
    }

    .tag-button-icon {
      font-size: 24px;
      margin-bottom: var(--space-2);
    }

    .tag-button-name {
      font-size: 14px;
      font-weight: 600;
      color: var(--heading);
      margin-bottom: var(--space-1);
    }

    .tag-button-count {
      font-size: 12px;
      color: var(--secondary);
    }

    .tag-button.selected .tag-button-count {
      color: var(--primary-6);
      font-weight: 600;
    }

    /* é¢„è§ˆé¢æ¿ */
    .preview-panel {
      background: var(--white);
      border-radius: var(--radius-lg);
      padding: var(--space-5);
    }

    .preview-section {
      margin-bottom: var(--space-5);
    }

    .preview-section:last-child {
      margin-bottom: 0;
    }

    .preview-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: var(--space-3);
      display: flex;
      align-items: center;
      gap: var(--space-2);
    }

    .preview-tag-list {
      margin-bottom: var(--space-3);
    }

    .preview-tag-item {
      padding: var(--space-2) 0;
      border-bottom: 1px dashed var(--gray-3);
    }

    .preview-tag-item:last-child {
      border-bottom: none;
    }

    .preview-tag-name {
      font-size: 13px;
      color: var(--text);
      margin-bottom: 2px;
    }

    .preview-tag-count {
      font-size: 12px;
      color: var(--secondary);
    }

    .preview-total {
      padding: var(--space-3);
      background: var(--gray-1);
      border-radius: var(--radius-md);
      text-align: center;
    }

    .preview-total-label {
      font-size: 12px;
      color: var(--secondary);
      margin-bottom: var(--space-1);
    }

    .preview-total-value {
      font-size: 24px;
      font-weight: 700;
      color: var(--primary-6);
    }

    .preview-total-unit {
      font-size: 14px;
      color: var(--text);
    }

    .estimate-box {
      background: linear-gradient(135deg, var(--primary-1) 0%, var(--primary-2) 100%);
      border: 1px solid var(--primary-3);
      border-radius: var(--radius-md);
      padding: var(--space-4);
      text-align: center;
    }

    .estimate-label {
      font-size: 12px;
      color: var(--secondary);
      margin-bottom: var(--space-1);
    }

    .estimate-value {
      font-size: 32px;
      font-weight: 700;
      color: var(--primary-6);
      line-height: 1;
    }

    .estimate-unit {
      font-size: 14px;
      color: var(--secondary);
      margin-top: var(--space-1);
    }

    /* æ“ä½œæ  */
    .action-bar {
      display: flex;
      justify-content: space-between;
      margin-top: var(--space-6);
      padding: var(--space-4) var(--space-6);
      background: var(--white);
      border-radius: var(--radius-lg);
      position: sticky;
      bottom: var(--space-4);
      box-shadow: var(--shadow-lg);
    }

    .create-tag-btn {
      color: var(--primary-6);
      border: 1px dashed var(--primary-4);
      padding: var(--space-2) var(--space-3);
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: all var(--transition-base);
      font-size: 14px;
    }

    .create-tag-btn:hover {
      background: var(--primary-1);
      border-color: var(--primary-6);
    }

    .info-tip {
      padding: var(--space-3);
      background: var(--blue-1);
      border-left: 3px solid var(--blue-6);
      border-radius: var(--radius-sm);
      font-size: 13px;
      color: var(--text);
      margin-top: var(--space-3);
    }

    .steps-indicator {
      display: flex;
      justify-content: space-between;
      margin-bottom: var(--space-6);
      padding: var(--space-4);
      background: var(--white);
      border-radius: var(--radius-lg);
    }

    .step-item {
      flex: 1;
      text-align: center;
      position: relative;
    }

    .step-item:not(:last-child)::after {
      content: '';
      position: absolute;
      top: 15px;
      right: -50%;
      width: 100%;
      height: 2px;
      background: var(--gray-3);
      z-index: -1;
    }

    .step-item.active .step-number {
      background: var(--primary-6);
      color: var(--white);
    }

    .step-item.completed .step-number {
      background: var(--success-6);
      color: var(--white);
    }

    .step-item.active:not(:last-child)::after {
      background: var(--primary-3);
    }

    .step-number {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: var(--gray-3);
      color: var(--gray-6);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      margin-bottom: var(--space-2);
    }

    .step-label {
      font-size: 12px;
      color: var(--secondary);
    }

    .step-item.active .step-label {
      color: var(--primary-6);
      font-weight: 600;
    }
  </style>
</head>
<body>
  <div class="page-container">
    <!-- é¡µé¢å¤´éƒ¨ -->
    <div class="page-header">
      <h1 class="page-title">æ™ºèƒ½æ‰¹é‡åˆ›ç¼– - é€‰æ‹©æ ‡ç­¾</h1>
      <div class="flex gap-3">
        <button class="btn btn-default" onclick="goBack()">â† è¿”å›</button>
        <button class="btn btn-default" onclick="saveAsDraft()">ğŸ’¾ ä¿å­˜è‰ç¨¿</button>
      </div>
    </div>

    <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ -->
    <div class="page-content">
      <div class="steps-indicator fade-in">
        <div class="step-item active">
          <div class="step-number">1</div>
          <div class="step-label">é€‰æ‹©æ ‡ç­¾</div>
        </div>
        <div class="step-item">
          <div class="step-number">2</div>
          <div class="step-label">é…ç½®è§„åˆ™</div>
        </div>
        <div class="step-item">
          <div class="step-number">3</div>
          <div class="step-label">é¢„è§ˆè®¡åˆ’</div>
        </div>
        <div class="step-item">
          <div class="step-number">4</div>
          <div class="step-label">æäº¤åˆ›å»º</div>
        </div>
      </div>

      <div class="tag-selection-container">
        <!-- å·¦ä¾§ï¼šæ ‡ç­¾é€‰æ‹©åŒº -->
        <div class="tag-left">
          <!-- 1ï¸âƒ£ é€‰æ‹©ä¸»ä½“æ ‡ç­¾ -->
          <div class="tag-section slide-up">
            <div class="tag-section-header">
              <div class="tag-section-title">
                <span>1ï¸âƒ£</span>
                <span>é€‰æ‹©ä¸»ä½“æ ‡ç­¾</span>
                <span style="color: var(--error); font-size: 14px;">*</span>
              </div>
              <div class="tag-section-badge" id="subjectBadge">å·²é€‰ 0 ä¸ªæ ‡ç­¾</div>
            </div>

            <div class="tag-category-title">ğŸ·ï¸ ç³»ç»Ÿæ ‡ç­¾</div>

            <!-- è·‘é‡ä¸»ä½“ -->
            <div class="tag-card" data-tag-id="subject_running" onclick="toggleTag(this, 'subject')">
              <div class="tag-card-header">
                <input type="checkbox" class="tag-card-checkbox" onclick="event.stopPropagation()">
                <div class="tag-card-content">
                  <div class="tag-card-name">è·‘é‡ä¸»ä½“</div>
                  <div class="tag-card-count">ğŸ“Š åŒ…å« 30 ä¸ªä¸»ä½“</div>

                  <div class="tag-card-rules">
                    <div class="tag-card-rules-title">ç­›é€‰è§„åˆ™ï¼š</div>
                    <div class="tag-card-rule-item">â€¢ æŠ•æ”¾çŠ¶æ€ = è·‘é‡</div>
                    <div class="tag-card-rule-item">â€¢ æœ€è¿‘7å¤©æœ‰æ¶ˆè€—</div>
                    <div class="tag-card-rule-item">â€¢ è´¦æˆ·ä½™é¢ > 1000å…ƒ</div>
                  </div>
                </div>
              </div>

              <div class="tag-card-footer">
                <div class="tag-card-dynamic">ğŸ’¡ è‡ªåŠ¨åŒ…å«æ–°å¢æ•°æ®</div>
                <div class="tag-card-time">æ›´æ–°äº 2åˆ†é’Ÿå‰</div>
              </div>
            </div>

            <!-- é«˜è½¬åŒ–ä¸»ä½“ -->
            <div class="tag-card" data-tag-id="subject_high_conversion" onclick="toggleTag(this, 'subject')">
              <div class="tag-card-header">
                <input type="checkbox" class="tag-card-checkbox" onclick="event.stopPropagation()">
                <div class="tag-card-content">
                  <div class="tag-card-name">é«˜è½¬åŒ–ä¸»ä½“</div>
                  <div class="tag-card-count">ğŸ“Š åŒ…å« 15 ä¸ªä¸»ä½“</div>

                  <div class="tag-card-rules">
                    <div class="tag-card-rules-title">ç­›é€‰è§„åˆ™ï¼š</div>
                    <div class="tag-card-rule-item">â€¢ è¿‘30å¤©è½¬åŒ–æ•° > 100</div>
                    <div class="tag-card-rule-item">â€¢ è½¬åŒ–ç‡ > 3%</div>
                  </div>
                </div>
              </div>

              <div class="tag-card-footer">
                <div class="tag-card-dynamic">ğŸ’¡ è‡ªåŠ¨åŒ…å«æ–°å¢æ•°æ®</div>
                <div class="tag-card-time">æ›´æ–°äº 5åˆ†é’Ÿå‰</div>
              </div>
            </div>

            <!-- æ–°ä¸»ä½“ -->
            <div class="tag-card" data-tag-id="subject_new" onclick="toggleTag(this, 'subject')">
              <div class="tag-card-header">
                <input type="checkbox" class="tag-card-checkbox" onclick="event.stopPropagation()">
                <div class="tag-card-content">
                  <div class="tag-card-name">æ–°ä¸»ä½“</div>
                  <div class="tag-card-count">ğŸ“Š åŒ…å« 8 ä¸ªä¸»ä½“</div>

                  <div class="tag-card-rules">
                    <div class="tag-card-rules-title">ç­›é€‰è§„åˆ™ï¼š</div>
                    <div class="tag-card-rule-item">â€¢ å¼€æˆ·å¤©æ•° < 7å¤©</div>
                    <div class="tag-card-rule-item">â€¢ æµ‹è¯•é˜¶æ®µ</div>
                  </div>
                </div>
              </div>

              <div class="tag-card-footer">
                <div class="tag-card-dynamic">ğŸ’¡ è‡ªåŠ¨åŒ…å«æ–°å¢æ•°æ®</div>
                <div class="tag-card-time">æ›´æ–°äº 10åˆ†é’Ÿå‰</div>
              </div>
            </div>

            <div class="tag-category-title" style="margin-top: var(--space-4);">ğŸ·ï¸ æˆ‘çš„è‡ªå®šä¹‰æ ‡ç­¾</div>

            <!-- è‡ªå®šä¹‰æ ‡ç­¾ç¤ºä¾‹ -->
            <div class="tag-card" data-tag-id="subject_beijing_vip" onclick="toggleTag(this, 'subject')">
              <div class="tag-card-header">
                <input type="checkbox" class="tag-card-checkbox" onclick="event.stopPropagation()">
                <div class="tag-card-content">
                  <div class="tag-card-name">åŒ—äº¬åœ°åŒºVIPå®¢æˆ·</div>
                  <div class="tag-card-count">ğŸ“Š åŒ…å« 5 ä¸ªä¸»ä½“</div>

                  <div class="tag-card-rules">
                    <div class="tag-card-rules-title">ç­›é€‰è§„åˆ™ï¼š</div>
                    <div class="tag-card-rule-item">â€¢ åœ°åŒº = åŒ—äº¬</div>
                    <div class="tag-card-rule-item">â€¢ å®¢æˆ·ç±»å‹ = VIP</div>
                    <div class="tag-card-rule-item">â€¢ æŠ•æ”¾çŠ¶æ€ = è·‘é‡</div>
                  </div>
                </div>
              </div>

              <div class="tag-card-footer">
                <div class="tag-card-dynamic">ğŸ’¡ è‡ªåŠ¨åŒ…å«æ–°å¢æ•°æ®</div>
                <div class="tag-card-time">åˆ›å»ºäº 2å¤©å‰</div>
              </div>
            </div>

            <div class="create-tag-btn" onclick="createNewTag('subject')">
              + åˆ›å»ºæ–°çš„ä¸»ä½“æ ‡ç­¾
            </div>

            <div class="info-tip">
              ğŸ’¡ <strong>æç¤ºï¼š</strong>æ ‡ç­¾ä¼šè‡ªåŠ¨åŒ…å«æ–°å¢çš„ä¸»ä½“ï¼Œæ— éœ€æ‰‹åŠ¨æ›´æ–°ã€‚å·²é€‰æ‹© <span id="subjectCount">0</span> ä¸ªæ ‡ç­¾ï¼Œå®æ—¶åŒ¹é… <span id="subjectMatchCount">0</span> ä¸ªä¸»ä½“ã€‚
            </div>
          </div>

          <!-- 2ï¸âƒ£ é€‰æ‹©é¡¹ç›®æ ‡ç­¾ -->
          <div class="tag-section slide-up" style="animation-delay: 0.1s;">
            <div class="tag-section-header">
              <div class="tag-section-title">
                <span>2ï¸âƒ£</span>
                <span>é€‰æ‹©é¡¹ç›®æ ‡ç­¾</span>
                <span style="color: var(--error); font-size: 14px;">*</span>
              </div>
              <div class="tag-section-badge" id="projectBadge">å·²é€‰ 0 ä¸ªæ ‡ç­¾</div>
            </div>

            <div class="tag-category-title">ğŸ·ï¸ æŒ‰é¢˜æåˆ†ç±»</div>

            <div class="tag-grid">
              <div class="tag-button" data-tag-id="project_badao" onclick="toggleButtonTag(this, 'project')">
                <div class="tag-button-icon">ğŸ‘”</div>
                <div class="tag-button-name">éœ¸é“æ€»è£</div>
                <div class="tag-button-count">356ä¸ªé¡¹ç›®</div>
              </div>

              <div class="tag-button" data-tag-id="project_chuanyue" onclick="toggleButtonTag(this, 'project')">
                <div class="tag-button-icon">ğŸšª</div>
                <div class="tag-button-name">ç©¿è¶Šé‡ç”Ÿ</div>
                <div class="tag-button-count">289ä¸ªé¡¹ç›®</div>
              </div>

              <div class="tag-button" data-tag-id="project_dushi" onclick="toggleButtonTag(this, 'project')">
                <div class="tag-button-icon">ğŸ™ï¸</div>
                <div class="tag-button-name">éƒ½å¸‚è¨€æƒ…</div>
                <div class="tag-button-count">421ä¸ªé¡¹ç›®</div>
              </div>

              <div class="tag-button" data-tag-id="project_gudai" onclick="toggleButtonTag(this, 'project')">
                <div class="tag-button-icon">ğŸ®</div>
                <div class="tag-button-name">å¤ä»£è¨€æƒ…</div>
                <div class="tag-button-count">198ä¸ªé¡¹ç›®</div>
              </div>

              <div class="tag-button" data-tag-id="project_xuanhuan" onclick="toggleButtonTag(this, 'project')">
                <div class="tag-button-icon">âš”ï¸</div>
                <div class="tag-button-name">ç„å¹»ä¿®ä»™</div>
                <div class="tag-button-count">167ä¸ªé¡¹ç›®</div>
              </div>

              <div class="tag-button" data-tag-id="project_xuanyi" onclick="toggleButtonTag(this, 'project')">
                <div class="tag-button-icon">ğŸ”</div>
                <div class="tag-button-name">æ‚¬ç–‘æ¨ç†</div>
                <div class="tag-button-count">89ä¸ªé¡¹ç›®</div>
              </div>

              <div class="tag-button" data-tag-id="project_other" onclick="toggleButtonTag(this, 'project')">
                <div class="tag-button-icon">ğŸ“š</div>
                <div class="tag-button-name">å…¶ä»–é¢˜æ</div>
                <div class="tag-button-count">124ä¸ªé¡¹ç›®</div>
              </div>
            </div>

            <div class="tag-category-title" style="margin-top: var(--space-4);">ğŸ·ï¸ æŒ‰æ•ˆæœåˆ†ç±»</div>

            <div class="tag-grid" style="grid-template-columns: repeat(2, 1fr);">
              <div class="tag-button" data-tag-id="project_high_conversion" onclick="toggleButtonTag(this, 'project')">
                <div class="tag-button-icon">ğŸ“ˆ</div>
                <div class="tag-button-name">é«˜è½¬åŒ–é¡¹ç›®</div>
                <div class="tag-button-count">125ä¸ª</div>
              </div>

              <div class="tag-button" data-tag-id="project_new" onclick="toggleButtonTag(this, 'project')">
                <div class="tag-button-icon">ğŸ†•</div>
                <div class="tag-button-name">æ–°ä¸Šçº¿é¡¹ç›®</div>
                <div class="tag-button-count">89ä¸ª</div>
              </div>

              <div class="tag-button" data-tag-id="project_hot" onclick="toggleButtonTag(this, 'project')">
                <div class="tag-button-icon">ğŸ”¥</div>
                <div class="tag-button-name">çƒ­é—¨é¡¹ç›®</div>
                <div class="tag-button-count">156ä¸ª</div>
              </div>

              <div class="tag-button" data-tag-id="project_test" onclick="toggleButtonTag(this, 'project')">
                <div class="tag-button-icon">ğŸ§ª</div>
                <div class="tag-button-name">æµ‹è¯•é¡¹ç›®</div>
                <div class="tag-button-count">67ä¸ª</div>
              </div>
            </div>

            <div class="create-tag-btn" style="margin-top: var(--space-3);" onclick="createNewTag('project')">
              + åˆ›å»ºæ–°çš„é¡¹ç›®æ ‡ç­¾
            </div>

            <div class="info-tip">
              ğŸ’¡ <strong>æç¤ºï¼š</strong>å·²é€‰æ‹© <span id="projectCount">0</span> ä¸ªé¡¹ç›®æ ‡ç­¾ï¼ŒåŒ¹é… <span id="projectMatchCount">0</span> ä¸ªé¡¹ç›®ã€‚
            </div>
          </div>
        </div>

        <!-- å³ä¾§ï¼šå®æ—¶é¢„è§ˆ -->
        <div class="tag-right">
          <div class="preview-panel">
            <div class="preview-section">
              <div class="preview-title">
                <span>ğŸ“Š</span>
                <span>æ ‡ç­¾åŒ¹é…é¢„è§ˆ</span>
              </div>

              <!-- ä¸»ä½“æ ‡ç­¾ -->
              <div style="margin-bottom: var(--space-4);">
                <div style="font-size: 13px; font-weight: 600; color: var(--text); margin-bottom: var(--space-2);">
                  ä¸»ä½“æ ‡ç­¾: <span id="previewSubjectTagCount">0</span> ä¸ª
                </div>
                <div class="preview-tag-list" id="previewSubjectTags">
                  <div style="font-size: 13px; color: var(--secondary);">æš‚æ— é€‰æ‹©</div>
                </div>
                <div class="preview-total">
                  <div class="preview-total-label">åŒ¹é…ä¸»ä½“</div>
                  <div class="preview-total-value" id="previewSubjectTotal">0</div>
                  <div class="preview-total-unit">ä¸ª</div>
                </div>
              </div>

              <!-- é¡¹ç›®æ ‡ç­¾ -->
              <div style="margin-bottom: var(--space-4);">
                <div style="font-size: 13px; font-weight: 600; color: var(--text); margin-bottom: var(--space-2);">
                  é¡¹ç›®æ ‡ç­¾: <span id="previewProjectTagCount">0</span> ä¸ª
                </div>
                <div class="preview-tag-list" id="previewProjectTags">
                  <div style="font-size: 13px; color: var(--secondary);">æš‚æ— é€‰æ‹©</div>
                </div>
                <div class="preview-total">
                  <div class="preview-total-label">åŒ¹é…é¡¹ç›®</div>
                  <div class="preview-total-value" id="previewProjectTotal">0</div>
                  <div class="preview-total-unit">ä¸ª</div>
                </div>
              </div>
            </div>

            <div class="preview-section">
              <div class="preview-title">
                <span>ğŸ’¡</span>
                <span>ç”Ÿæˆé¢„ä¼°</span>
              </div>

              <div class="estimate-box">
                <div class="estimate-label">æ ¹æ®å½“å‰æ ‡ç­¾</div>
                <div class="estimate-value" id="estimatedCount">0</div>
                <div class="estimate-unit">æ¡å¹¿å‘Šè®¡åˆ’</div>
              </div>

              <div style="margin-top: var(--space-3); font-size: 12px; color: var(--secondary); text-align: center;">
                âš ï¸ éœ€ç»§ç»­é€‰æ‹©ç´ æå’Œå°è¯´æ ‡ç­¾
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- æ“ä½œæ  -->
      <div class="action-bar">
        <button class="btn btn-default" onclick="goBack()">â† å–æ¶ˆ</button>
        <button class="btn btn-primary" id="nextBtn" disabled onclick="nextStep()">
          ä¸‹ä¸€æ­¥ï¼šç»§ç»­é€‰æ‹©æ ‡ç­¾ â†’
        </button>
      </div>
    </div>
  </div>

  <script src="js/main.js"></script>
  <script>
    // æ ‡ç­¾æ•°æ®
    const tagData = {
      subject_running: { name: 'è·‘é‡ä¸»ä½“', count: 30 },
      subject_high_conversion: { name: 'é«˜è½¬åŒ–ä¸»ä½“', count: 15 },
      subject_new: { name: 'æ–°ä¸»ä½“', count: 8 },
      subject_beijing_vip: { name: 'åŒ—äº¬åœ°åŒºVIPå®¢æˆ·', count: 5 },
      project_badao: { name: 'éœ¸é“æ€»è£', count: 356 },
      project_chuanyue: { name: 'ç©¿è¶Šé‡ç”Ÿ', count: 289 },
      project_dushi: { name: 'éƒ½å¸‚è¨€æƒ…', count: 421 },
      project_gudai: { name: 'å¤ä»£è¨€æƒ…', count: 198 },
      project_xuanhuan: { name: 'ç„å¹»ä¿®ä»™', count: 167 },
      project_xuanyi: { name: 'æ‚¬ç–‘æ¨ç†', count: 89 },
      project_other: { name: 'å…¶ä»–é¢˜æ', count: 124 },
      project_high_conversion: { name: 'é«˜è½¬åŒ–é¡¹ç›®', count: 125 },
      project_new: { name: 'æ–°ä¸Šçº¿é¡¹ç›®', count: 89 },
      project_hot: { name: 'çƒ­é—¨é¡¹ç›®', count: 156 },
      project_test: { name: 'æµ‹è¯•é¡¹ç›®', count: 67 }
    };

    // é€‰ä¸­çš„æ ‡ç­¾
    const selectedTags = {
      subject: [],
      project: []
    };

    // åˆ‡æ¢æ ‡ç­¾ï¼ˆè¯¦ç»†å¡ç‰‡ï¼‰
    function toggleTag(element, type) {
      const tagId = element.getAttribute('data-tag-id');
      const checkbox = element.querySelector('.tag-card-checkbox');

      if (element.classList.contains('selected')) {
        element.classList.remove('selected');
        checkbox.checked = false;
        selectedTags[type] = selectedTags[type].filter(id => id !== tagId);
      } else {
        element.classList.add('selected');
        checkbox.checked = true;
        selectedTags[type].push(tagId);
      }

      updatePreview();
      validateForm();
    }

    // åˆ‡æ¢æ ‡ç­¾ï¼ˆæŒ‰é’®å¼ï¼‰
    function toggleButtonTag(element, type) {
      const tagId = element.getAttribute('data-tag-id');

      if (element.classList.contains('selected')) {
        element.classList.remove('selected');
        selectedTags[type] = selectedTags[type].filter(id => id !== tagId);
      } else {
        element.classList.add('selected');
        selectedTags[type].push(tagId);
      }

      updatePreview();
      validateForm();
    }

    // æ›´æ–°é¢„è§ˆ
    function updatePreview() {
      // æ›´æ–°ä¸»ä½“æ ‡ç­¾
      const subjectTagCount = selectedTags.subject.length;
      let subjectTotalCount = 0;

      document.getElementById('subjectBadge').textContent = `å·²é€‰ ${subjectTagCount} ä¸ªæ ‡ç­¾`;
      document.getElementById('subjectCount').textContent = subjectTagCount;
      document.getElementById('previewSubjectTagCount').textContent = subjectTagCount;

      if (subjectTagCount > 0) {
        let html = '';
        selectedTags.subject.forEach(tagId => {
          const tag = tagData[tagId];
          subjectTotalCount += tag.count;
          html += `
            <div class="preview-tag-item">
              <div class="preview-tag-name">â”œâ”€ ${tag.name}</div>
              <div class="preview-tag-count">${tag.count}ä¸ªä¸»ä½“</div>
            </div>
          `;
        });
        document.getElementById('previewSubjectTags').innerHTML = html;
      } else {
        document.getElementById('previewSubjectTags').innerHTML = '<div style="font-size: 13px; color: var(--secondary);">æš‚æ— é€‰æ‹©</div>';
      }

      // å»é‡åçš„ä¸»ä½“æ•°é‡ï¼ˆç®€åŒ–è®¡ç®—ï¼‰
      const uniqueSubjectCount = subjectTagCount > 0 ? Math.floor(subjectTotalCount * 0.8) : 0;
      document.getElementById('subjectMatchCount').textContent = uniqueSubjectCount;
      document.getElementById('previewSubjectTotal').textContent = uniqueSubjectCount;

      // æ›´æ–°é¡¹ç›®æ ‡ç­¾
      const projectTagCount = selectedTags.project.length;
      let projectTotalCount = 0;

      document.getElementById('projectBadge').textContent = `å·²é€‰ ${projectTagCount} ä¸ªæ ‡ç­¾`;
      document.getElementById('projectCount').textContent = projectTagCount;
      document.getElementById('previewProjectTagCount').textContent = projectTagCount;

      if (projectTagCount > 0) {
        let html = '';
        selectedTags.project.forEach(tagId => {
          const tag = tagData[tagId];
          projectTotalCount += tag.count;
          html += `
            <div class="preview-tag-item">
              <div class="preview-tag-name">â”œâ”€ ${tag.name}</div>
              <div class="preview-tag-count">${tag.count}ä¸ªé¡¹ç›®</div>
            </div>
          `;
        });
        document.getElementById('previewProjectTags').innerHTML = html;
      } else {
        document.getElementById('previewProjectTags').innerHTML = '<div style="font-size: 13px; color: var(--secondary);">æš‚æ— é€‰æ‹©</div>';
      }

      const uniqueProjectCount = projectTagCount > 0 ? Math.floor(projectTotalCount * 0.8) : 0;
      document.getElementById('projectMatchCount').textContent = uniqueProjectCount;
      document.getElementById('previewProjectTotal').textContent = uniqueProjectCount;

      // æ›´æ–°é¢„ä¼°æ•°é‡ï¼ˆç®€åŒ–ï¼‰
      const estimatedCount = uniqueSubjectCount && uniqueProjectCount ? uniqueSubjectCount * 5 : 0;
      document.getElementById('estimatedCount').textContent = estimatedCount;
    }

    // è¡¨å•éªŒè¯
    function validateForm() {
      const isValid = selectedTags.subject.length > 0 && selectedTags.project.length > 0;
      document.getElementById('nextBtn').disabled = !isValid;
    }

    // è¿”å›
    function goBack() {
      window.location.href = 'create-new.html';
    }

    // ä¿å­˜è‰ç¨¿
    function saveAsDraft() {
      DataStore.save('selectedTags_step1', selectedTags);
      Message.success('è‰ç¨¿å·²ä¿å­˜');
    }

    // ä¸‹ä¸€æ­¥
    function nextStep() {
      if (selectedTags.subject.length === 0 || selectedTags.project.length === 0) {
        Message.error('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªä¸»ä½“æ ‡ç­¾å’Œä¸€ä¸ªé¡¹ç›®æ ‡ç­¾');
        return;
      }

      DataStore.save('selectedTags_step1', selectedTags);
      Message.success('æ ‡ç­¾å·²ä¿å­˜ï¼Œè¿›å…¥ä¸‹ä¸€æ­¥...');

      setTimeout(() => {
        window.location.href = 'tag-selection-step2.html';
      }, 500);
    }

    // åˆ›å»ºæ–°æ ‡ç­¾
    function createNewTag(type) {
      Message.info(`åˆ›å»º${type === 'subject' ? 'ä¸»ä½“' : 'é¡¹ç›®'}æ ‡ç­¾åŠŸèƒ½å¼€å‘ä¸­...`);
    }

    // é¡µé¢åŠ è½½æ—¶æ¢å¤è‰ç¨¿
    window.addEventListener('DOMContentLoaded', () => {
      const savedTags = DataStore.load('selectedTags_step1');
      if (savedTags) {
        selectedTags.subject = savedTags.subject || [];
        selectedTags.project = savedTags.project || [];

        // æ¢å¤é€‰ä¸­çŠ¶æ€
        selectedTags.subject.forEach(tagId => {
          const element = document.querySelector(`[data-tag-id="${tagId}"]`);
          if (element) {
            element.classList.add('selected');
            const checkbox = element.querySelector('.tag-card-checkbox');
            if (checkbox) checkbox.checked = true;
          }
        });

        selectedTags.project.forEach(tagId => {
          const element = document.querySelector(`[data-tag-id="${tagId}"]`);
          if (element) {
            element.classList.add('selected');
          }
        });

        updatePreview();
        validateForm();
      }
    });
  </script>
</body>
</html>
