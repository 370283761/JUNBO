<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Step 3: é…ç½®ç”Ÿæˆè§„åˆ™ - æ™ºèƒ½æ‰¹é‡åˆ›ç¼–</title>
  <link rel="stylesheet" href="css/style.css">
  <style>
    .config-container {
      max-width: 1200px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 800px 1fr;
      gap: var(--space-6);
      align-items: start;
    }

    .config-main {
      background: var(--white);
      border-radius: var(--radius-lg);
      padding: var(--space-6);
    }

    .template-section {
      margin-bottom: var(--space-6);
    }

    .template-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: var(--space-4);
      display: flex;
      align-items: center;
      gap: var(--space-2);
    }

    .template-grid {
      display: grid;
      gap: var(--space-3);
    }

    .template-card {
      border: 2px solid var(--gray-3);
      border-radius: var(--radius-lg);
      padding: var(--space-5);
      cursor: pointer;
      transition: all var(--transition-base);
      position: relative;
    }

    .template-card:hover {
      border-color: var(--primary-5);
      box-shadow: var(--shadow-md);
    }

    .template-card.selected {
      border-color: var(--primary-6);
      background: var(--primary-1);
    }

    .template-card-badge {
      position: absolute;
      top: var(--space-3);
      right: var(--space-3);
      padding: 4px 12px;
      background: var(--warning-1);
      color: var(--warning-7);
      border-radius: var(--radius-full);
      font-size: 11px;
      font-weight: 600;
    }

    .template-card.selected .template-card-badge {
      background: var(--primary-6);
      color: var(--white);
    }

    .template-card-header {
      display: flex;
      align-items: flex-start;
      gap: var(--space-3);
      margin-bottom: var(--space-3);
    }

    .template-card-icon {
      font-size: 32px;
    }

    .template-card-content {
      flex: 1;
    }

    .template-card-name {
      font-size: 16px;
      font-weight: 600;
      color: var(--heading);
      margin-bottom: var(--space-2);
    }

    .template-card-desc {
      font-size: 13px;
      color: var(--secondary);
      margin-bottom: var(--space-3);
      line-height: 1.6;
    }

    .template-card-formula {
      padding: var(--space-3);
      background: var(--gray-1);
      border-radius: var(--radius-md);
      margin-bottom: var(--space-3);
    }

    .template-card.selected .template-card-formula {
      background: var(--white);
    }

    .formula-text {
      font-size: 13px;
      color: var(--text);
      margin-bottom: var(--space-2);
    }

    .formula-calc {
      font-size: 14px;
      font-weight: 600;
      color: var(--primary-6);
    }

    .template-card-result {
      font-size: 15px;
      font-weight: 700;
      color: var(--success-6);
      text-align: center;
      padding: var(--space-2);
      background: var(--success-1);
      border-radius: var(--radius-md);
    }

    .custom-config {
      background: var(--gray-1);
      border-radius: var(--radius-lg);
      padding: var(--space-5);
      margin-top: var(--space-4);
      display: none;
    }

    .custom-config.active {
      display: block;
    }

    .config-row {
      margin-bottom: var(--space-4);
    }

    .config-row:last-child {
      margin-bottom: 0;
    }

    .config-label {
      font-size: 14px;
      font-weight: 600;
      color: var(--heading);
      margin-bottom: var(--space-2);
      display: flex;
      align-items: center;
      gap: var(--space-2);
    }

    .config-input-group {
      display: flex;
      align-items: center;
      gap: var(--space-2);
    }

    .config-input {
      width: 100px;
      padding: var(--space-2) var(--space-3);
      border: 1px solid var(--gray-4);
      border-radius: var(--radius-md);
      font-size: 14px;
    }

    .config-input:focus {
      border-color: var(--primary-6);
      outline: none;
    }

    .config-sub {
      margin-left: var(--space-5);
      margin-top: var(--space-2);
      padding-left: var(--space-3);
      border-left: 2px solid var(--gray-3);
    }

    .preview-panel {
      background: var(--white);
      border-radius: var(--radius-lg);
      padding: var(--space-5);
      position: sticky;
      top: var(--space-6);
    }

    .preview-section {
      margin-bottom: var(--space-5);
    }

    .preview-section:last-child {
      margin-bottom: 0;
    }

    .preview-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: var(--space-3);
      display: flex;
      align-items: center;
      gap: var(--space-2);
    }

    .preview-item {
      padding: var(--space-2) 0;
      display: flex;
      justify-content: space-between;
      border-bottom: 1px dashed var(--gray-3);
      font-size: 13px;
    }

    .preview-item:last-child {
      border-bottom: none;
    }

    .preview-label {
      color: var(--secondary);
    }

    .preview-value {
      font-weight: 600;
      color: var(--text);
    }

    .estimate-box {
      background: linear-gradient(135deg, var(--success-1) 0%, var(--success-2) 100%);
      border: 1px solid var(--success-3);
      border-radius: var(--radius-lg);
      padding: var(--space-5);
      text-align: center;
    }

    .estimate-label {
      font-size: 13px;
      color: var(--secondary);
      margin-bottom: var(--space-2);
    }

    .estimate-value {
      font-size: 48px;
      font-weight: 700;
      color: var(--success-6);
      line-height: 1;
      margin-bottom: var(--space-1);
    }

    .estimate-unit {
      font-size: 16px;
      color: var(--text);
      font-weight: 600;
    }

    .estimate-breakdown {
      margin-top: var(--space-3);
      padding-top: var(--space-3);
      border-top: 1px solid var(--success-3);
      font-size: 12px;
      color: var(--secondary);
    }

    .action-bar {
      display: flex;
      justify-content: space-between;
      margin-top: var(--space-6);
      padding: var(--space-4) var(--space-6);
      background: var(--white);
      border-radius: var(--radius-lg);
      position: sticky;
      bottom: var(--space-4);
      box-shadow: var(--shadow-lg);
    }

    .steps-indicator {
      display: flex;
      justify-content: space-between;
      margin-bottom: var(--space-6);
      padding: var(--space-4);
      background: var(--white);
      border-radius: var(--radius-lg);
    }

    .step-item {
      flex: 1;
      text-align: center;
      position: relative;
    }

    .step-item:not(:last-child)::after {
      content: '';
      position: absolute;
      top: 15px;
      right: -50%;
      width: 100%;
      height: 2px;
      background: var(--gray-3);
      z-index: -1;
    }

    .step-item.active .step-number {
      background: var(--primary-6);
      color: var(--white);
    }

    .step-item.completed .step-number {
      background: var(--success-6);
      color: var(--white);
    }

    .step-item.completed:not(:last-child)::after {
      background: var(--success-3);
    }

    .step-number {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: var(--gray-3);
      color: var(--gray-6);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      margin-bottom: var(--space-2);
    }

    .step-label {
      font-size: 12px;
      color: var(--secondary);
    }

    .step-item.active .step-label {
      color: var(--primary-6);
      font-weight: 600;
    }

    .step-item.completed .step-label {
      color: var(--success-6);
    }

    .toggle-btn {
      padding: var(--space-2) var(--space-3);
      border: 1px solid var(--gray-4);
      border-radius: var(--radius-md);
      background: var(--white);
      cursor: pointer;
      font-size: 13px;
      color: var(--text);
      transition: all var(--transition-base);
    }

    .toggle-btn:hover {
      border-color: var(--primary-6);
      color: var(--primary-6);
    }
  </style>
</head>
<body>
  <div class="page-container">
    <!-- é¡µé¢å¤´éƒ¨ -->
    <div class="page-header">
      <h1 class="page-title">æ™ºèƒ½æ‰¹é‡åˆ›ç¼– - é…ç½®è§„åˆ™</h1>
      <div class="flex gap-3">
        <button class="btn btn-default" onclick="goBack()">â† è¿”å›ä¸Šä¸€æ­¥</button>
        <button class="btn btn-default" onclick="saveAsDraft()">ğŸ’¾ ä¿å­˜è‰ç¨¿</button>
      </div>
    </div>

    <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ -->
    <div class="page-content">
      <div class="steps-indicator fade-in">
        <div class="step-item completed">
          <div class="step-number">âœ“</div>
          <div class="step-label">é€‰æ‹©æ ‡ç­¾</div>
        </div>
        <div class="step-item completed">
          <div class="step-number">âœ“</div>
          <div class="step-label">ç´ æ&å°è¯´</div>
        </div>
        <div class="step-item active">
          <div class="step-number">3</div>
          <div class="step-label">é…ç½®è§„åˆ™</div>
        </div>
        <div class="step-item">
          <div class="step-number">4</div>
          <div class="step-label">é¢„è§ˆ&æäº¤</div>
        </div>
      </div>

      <div class="config-container">
        <!-- å·¦ä¾§ï¼šè§„åˆ™é…ç½® -->
        <div class="config-main">
          <div class="template-section">
            <div class="template-title">
              <span>ğŸ“‹</span>
              <span>é€‰æ‹©è§„åˆ™æ¨¡æ¿ï¼ˆæ¨èï¼‰</span>
            </div>

            <div class="template-grid">
              <!-- æ¨¡æ¿1ï¼šå…¨é‡ç»„åˆ -->
              <div class="template-card" data-template="template1" onclick="selectTemplate('template1')">
                <div class="template-card-badge">ç®€å•é«˜æ•ˆ</div>
                <div class="template-card-header">
                  <div class="template-card-icon">âš¡</div>
                  <div class="template-card-content">
                    <div class="template-card-name">è§„åˆ™æ¨¡æ¿1ï¼šå…¨é‡ç»„åˆ</div>
                    <div class="template-card-desc">
                      ä¸»ä½“ Ã— é¡¹ç›® Ã— å°è¯´ Ã— ç´ æ = å…¨é‡ç»„åˆç”Ÿæˆ<br>
                      é€‚åˆï¼šå¿«é€Ÿèµ·é‡ã€å…¨é¢è¦†ç›–
                    </div>
                  </div>
                </div>

                <div class="template-card-formula">
                  <div class="formula-text">æ ¹æ®æ‚¨é€‰æ‹©çš„æ ‡ç­¾ï¼š</div>
                  <div class="formula-calc">
                    25 ä¸»ä½“ Ã— 481 é¡¹ç›® Ã— 234 å°è¯´ Ã· 10000<br>
                    Ã— 3 ç´ æ/å¹¿å‘Š = <strong id="template1Count">843</strong> æ¡
                  </div>
                </div>

                <div class="template-card-result">
                  é¢„è®¡ç”Ÿæˆï¼š<span id="template1Result">843</span> æ¡å¹¿å‘Šè®¡åˆ’
                </div>
              </div>

              <!-- æ¨¡æ¿2ï¼šæŒ‰è´¦æˆ·ç”Ÿæˆ -->
              <div class="template-card selected" data-template="template2" onclick="selectTemplate('template2')">
                <div class="template-card-badge">æ¨èä½¿ç”¨</div>
                <div class="template-card-header">
                  <div class="template-card-icon">ğŸ¯</div>
                  <div class="template-card-content">
                    <div class="template-card-name">è§„åˆ™æ¨¡æ¿2ï¼šæŒ‰è´¦æˆ·ç”Ÿæˆ</div>
                    <div class="template-card-desc">
                      æ¯ä¸ªè´¦æˆ·ç”Ÿæˆ N ä¸ªå¹¿å‘Šï¼Œè‡ªåŠ¨åˆ†é…ç´ æ<br>
                      é€‚åˆï¼šç²¾ç»†åŒ–æŠ•æ”¾ã€æ•ˆæœä¼˜åŒ–
                    </div>
                  </div>
                </div>

                <div class="template-card-formula">
                  <div class="formula-text">æ ¹æ®æ‚¨é€‰æ‹©çš„æ ‡ç­¾ï¼š</div>
                  <div class="formula-calc">
                    ç­›é€‰ç¬¦åˆæ¡ä»¶çš„è´¦æˆ·ï¼šçº¦ 125 ä¸ª<br>
                    æ¯è´¦æˆ·ç”Ÿæˆ 6 ä¸ªå¹¿å‘Šï¼ˆ3è§£å‹ + 3æ»šå±ï¼‰<br>
                    = <strong id="template2Count">750</strong> æ¡
                  </div>
                </div>

                <div class="template-card-result">
                  é¢„è®¡ç”Ÿæˆï¼š<span id="template2Result">750</span> æ¡å¹¿å‘Šè®¡åˆ’
                </div>
              </div>

              <!-- æ¨¡æ¿3ï¼šè‡ªå®šä¹‰ -->
              <div class="template-card" data-template="custom" onclick="selectTemplate('custom')">
                <div class="template-card-badge">çµæ´»é…ç½®</div>
                <div class="template-card-header">
                  <div class="template-card-icon">ğŸ”§</div>
                  <div class="template-card-content">
                    <div class="template-card-name">è‡ªå®šä¹‰è§„åˆ™</div>
                    <div class="template-card-desc">
                      å®Œå…¨è‡ªå®šä¹‰ç”Ÿæˆè§„åˆ™å’Œå‚æ•°<br>
                      é€‚åˆï¼šç‰¹æ®Šéœ€æ±‚ã€é«˜çº§ç”¨æˆ·
                    </div>
                  </div>
                </div>

                <div class="template-card-result">
                  ç‚¹å‡»å±•å¼€é…ç½®é€‰é¡¹
                </div>
              </div>
            </div>
          </div>

          <!-- è‡ªå®šä¹‰é…ç½®åŒº -->
          <div class="custom-config" id="customConfig">
            <div class="config-row">
              <div class="config-label">
                <span>ç”ŸæˆèŒƒå›´</span>
              </div>
              <div class="config-input-group">
                <label>
                  <input type="radio" name="scope" value="account" checked>
                  æŒ‰è´¦æˆ·ç”Ÿæˆ
                </label>
                <label>
                  <input type="radio" name="scope" value="subject">
                  æŒ‰ä¸»ä½“ç”Ÿæˆ
                </label>
                <label>
                  <input type="radio" name="scope" value="project">
                  æŒ‰é¡¹ç›®ç”Ÿæˆ
                </label>
              </div>
            </div>

            <div class="config-row">
              <div class="config-label">
                <span>å¹¿å‘Šæ•°é‡é…ç½®</span>
              </div>
              <div class="config-input-group">
                <span>æ¯ä¸ªè´¦æˆ·ç”Ÿæˆ</span>
                <input type="number" class="config-input" id="customAdCount" value="6" min="1" max="20" onchange="updateCustomEstimate()">
                <span>ä¸ªå¹¿å‘Š</span>
              </div>

              <div class="config-sub">
                <div class="config-input-group" style="margin-bottom: var(--space-2);">
                  <span>è§£å‹ç´ æï¼š</span>
                  <input type="number" class="config-input" id="customDecompress" value="3" min="0" max="10" onchange="updateCustomBreakdown()">
                  <span>ä¸ª</span>
                </div>
                <div class="config-input-group">
                  <span>æ»šå±ç´ æï¼š</span>
                  <input type="number" class="config-input" id="customScroll" value="3" min="0" max="10" onchange="updateCustomBreakdown()">
                  <span>ä¸ª</span>
                </div>
              </div>
            </div>

            <div class="config-row">
              <div class="config-label">
                <span>ç´ æåˆ†é…ç­–ç•¥</span>
              </div>

              <div style="margin-bottom: var(--space-2);">
                <div style="font-weight: 600; font-size: 13px; margin-bottom: var(--space-2);">è§£å‹ç´ æï¼š</div>
                <label style="display: block; margin-bottom: var(--space-1);">
                  <input type="checkbox" id="strategyDecompressExposure">
                  æŒ‰æ›å…‰é™åºé€‰æ‹©ç´ æ
                </label>
                <label style="display: block;">
                  <input type="checkbox" id="strategyDecompressRandom" checked>
                  éšæœºé€‰æ‹©ç´ æ
                </label>
              </div>

              <div>
                <div style="font-weight: 600; font-size: 13px; margin-bottom: var(--space-2);">æ»šå±ç´ æï¼š</div>
                <label style="display: block; margin-bottom: var(--space-1);">
                  <input type="checkbox" id="strategyScrollClicks" checked>
                  æŒ‰ç‚¹å‡»é™åºé€‰æ‹©ç´ æ
                </label>
                <label style="display: block;">
                  <input type="checkbox" id="strategyScrollRandom">
                  éšæœºé€‰æ‹©ç´ æ
                </label>
              </div>
            </div>

            <div style="margin-top: var(--space-4); padding: var(--space-3); background: var(--blue-1); border-radius: var(--radius-md); font-size: 13px;">
              ğŸ’¡ <strong>é¢„è®¡ç”Ÿæˆï¼š</strong><span id="customEstimate" style="color: var(--primary-6); font-weight: 700; font-size: 16px;">750</span> æ¡å¹¿å‘Šè®¡åˆ’
            </div>
          </div>
        </div>

        <!-- å³ä¾§ï¼šé¢„è§ˆé¢æ¿ -->
        <div class="preview-panel">
          <div class="preview-section">
            <div class="preview-title">
              <span>ğŸ“Š</span>
              <span>æ ‡ç­¾æ•°æ®æ±‡æ€»</span>
            </div>

            <div class="preview-item">
              <span class="preview-label">ä¸»ä½“æ ‡ç­¾</span>
              <span class="preview-value" id="summarySubjects">0 ä¸ª</span>
            </div>
            <div class="preview-item">
              <span class="preview-label">é¡¹ç›®æ ‡ç­¾</span>
              <span class="preview-value" id="summaryProjects">0 ä¸ª</span>
            </div>
            <div class="preview-item">
              <span class="preview-label">ç´ ææ ‡ç­¾</span>
              <span class="preview-value" id="summaryMaterials">0 ä¸ª</span>
            </div>
            <div class="preview-item">
              <span class="preview-label">å°è¯´æ ‡ç­¾</span>
              <span class="preview-value" id="summaryBooks">0 ä¸ª</span>
            </div>
          </div>

          <div class="preview-section">
            <div class="preview-title">
              <span>ğŸ¯</span>
              <span>åŒ¹é…æ•°æ®ç»Ÿè®¡</span>
            </div>

            <div class="preview-item">
              <span class="preview-label">ä¸»ä½“</span>
              <span class="preview-value" id="matchSubjects">25 ä¸ª</span>
            </div>
            <div class="preview-item">
              <span class="preview-label">é¡¹ç›®</span>
              <span class="preview-value" id="matchProjects">481 ä¸ª</span>
            </div>
            <div class="preview-item">
              <span class="preview-label">ç´ æ</span>
              <span class="preview-value" id="matchMaterials">15,801 ä¸ª</span>
            </div>
            <div class="preview-item">
              <span class="preview-label">å°è¯´</span>
              <span class="preview-value" id="matchBooks">234 æœ¬</span>
            </div>
            <div class="preview-item">
              <span class="preview-label">ç¬¦åˆæ¡ä»¶è´¦æˆ·</span>
              <span class="preview-value" id="matchAccounts">125 ä¸ª</span>
            </div>
          </div>

          <div class="preview-section">
            <div class="preview-title">
              <span>âœ…</span>
              <span>æœ€ç»ˆç”Ÿæˆé¢„ä¼°</span>
            </div>

            <div class="estimate-box">
              <div class="estimate-label">åŸºäºé€‰æ‹©çš„æ ‡ç­¾å’Œè§„åˆ™</div>
              <div class="estimate-value" id="finalEstimate">750</div>
              <div class="estimate-unit">æ¡å¹¿å‘Šè®¡åˆ’</div>

              <div class="estimate-breakdown">
                ä½¿ç”¨è§„åˆ™æ¨¡æ¿ï¼š<span id="finalTemplate">æ¨¡æ¿2ï¼ˆæŒ‰è´¦æˆ·ç”Ÿæˆï¼‰</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- æ“ä½œæ  -->
      <div class="action-bar">
        <button class="btn btn-default" onclick="goBack()">â† è¿”å›ä¸Šä¸€æ­¥</button>
        <button class="btn btn-primary" onclick="nextStep()">
          ä¸‹ä¸€æ­¥ï¼šé¢„è§ˆç”Ÿæˆç»“æœ â†’
        </button>
      </div>
    </div>
  </div>

  <script src="js/main.js"></script>
  <script>
    let selectedTemplate = 'template2';
    let allTags = {};

    // é€‰æ‹©æ¨¡æ¿
    function selectTemplate(templateId) {
      selectedTemplate = templateId;

      // æ›´æ–°UI
      document.querySelectorAll('.template-card').forEach(card => {
        card.classList.remove('selected');
      });

      document.querySelector(`[data-template="${templateId}"]`).classList.add('selected');

      // æ˜¾ç¤º/éšè—è‡ªå®šä¹‰é…ç½®
      if (templateId === 'custom') {
        document.getElementById('customConfig').classList.add('active');
      } else {
        document.getElementById('customConfig').classList.remove('active');
      }

      updateFinalEstimate();
    }

    // æ›´æ–°è‡ªå®šä¹‰åˆ†è§£
    function updateCustomBreakdown() {
      const decompress = parseInt(document.getElementById('customDecompress').value) || 0;
      const scroll = parseInt(document.getElementById('customScroll').value) || 0;
      const total = decompress + scroll;

      document.getElementById('customAdCount').value = total;
      updateCustomEstimate();
    }

    // æ›´æ–°è‡ªå®šä¹‰é¢„ä¼°
    function updateCustomEstimate() {
      const adCount = parseInt(document.getElementById('customAdCount').value) || 6;
      const accountCount = 125; // ç®€åŒ–è®¡ç®—

      const estimate = accountCount * adCount;
      document.getElementById('customEstimate').textContent = estimate;

      updateFinalEstimate();
    }

    // æ›´æ–°æœ€ç»ˆé¢„ä¼°
    function updateFinalEstimate() {
      let estimate = 750;
      let templateName = 'æ¨¡æ¿2ï¼ˆæŒ‰è´¦æˆ·ç”Ÿæˆï¼‰';

      if (selectedTemplate === 'template1') {
        estimate = 843;
        templateName = 'æ¨¡æ¿1ï¼ˆå…¨é‡ç»„åˆï¼‰';
      } else if (selectedTemplate === 'template2') {
        estimate = 750;
        templateName = 'æ¨¡æ¿2ï¼ˆæŒ‰è´¦æˆ·ç”Ÿæˆï¼‰';
      } else if (selectedTemplate === 'custom') {
        estimate = parseInt(document.getElementById('customEstimate').textContent) || 750;
        templateName = 'è‡ªå®šä¹‰è§„åˆ™';
      }

      document.getElementById('finalEstimate').textContent = estimate;
      document.getElementById('finalTemplate').textContent = templateName;
    }

    // è¿”å›
    function goBack() {
      window.location.href = 'tag-selection-step2.html';
    }

    // ä¿å­˜è‰ç¨¿
    function saveAsDraft() {
      const ruleConfig = {
        template: selectedTemplate,
        customConfig: {
          adCount: document.getElementById('customAdCount').value,
          decompress: document.getElementById('customDecompress').value,
          scroll: document.getElementById('customScroll').value
        }
      };

      DataStore.save('ruleConfig', ruleConfig);
      Message.success('è‰ç¨¿å·²ä¿å­˜');
    }

    // ä¸‹ä¸€æ­¥
    function nextStep() {
      const ruleConfig = {
        template: selectedTemplate,
        estimate: parseInt(document.getElementById('finalEstimate').textContent)
      };

      if (selectedTemplate === 'custom') {
        ruleConfig.customConfig = {
          adCount: parseInt(document.getElementById('customAdCount').value),
          decompress: parseInt(document.getElementById('customDecompress').value),
          scroll: parseInt(document.getElementById('customScroll').value)
        };
      }

      DataStore.save('ruleConfig', ruleConfig);
      DataStore.save('selectedTags_all', allTags);

      Message.success('è§„åˆ™é…ç½®å®Œæˆï¼Œç”Ÿæˆé¢„è§ˆä¸­...');

      setTimeout(() => {
        window.location.href = 'tag-preview-result.html';
      }, 500);
    }

    // é¡µé¢åŠ è½½
    window.addEventListener('DOMContentLoaded', () => {
      // åŠ è½½æ ‡ç­¾æ•°æ®
      allTags = DataStore.load('selectedTags_all') || {};

      // æ›´æ–°æ‘˜è¦
      const step1 = DataStore.load('selectedTags_step1') || {};
      const step2 = DataStore.load('selectedTags_step2') || {};

      document.getElementById('summarySubjects').textContent = (step1.subject || []).length + ' ä¸ª';
      document.getElementById('summaryProjects').textContent = (step1.project || []).length + ' ä¸ª';
      document.getElementById('summaryMaterials').textContent = (step2.material || []).length + ' ä¸ª';
      document.getElementById('summaryBooks').textContent = (step2.book || []).length + ' ä¸ª';

      // åŠ è½½è‰ç¨¿
      const savedConfig = DataStore.load('ruleConfig');
      if (savedConfig && savedConfig.template) {
        selectTemplate(savedConfig.template);

        if (savedConfig.customConfig) {
          document.getElementById('customAdCount').value = savedConfig.customConfig.adCount || 6;
          document.getElementById('customDecompress').value = savedConfig.customConfig.decompress || 3;
          document.getElementById('customScroll').value = savedConfig.customConfig.scroll || 3;
        }
      }

      updateFinalEstimate();
    });
  </script>
</body>
</html>
