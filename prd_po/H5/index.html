<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ‰¹é‡åˆ›ç¼–ç®¡ç† - å¹¿å‘ŠæŠ•æ”¾å¹³å°</title>
  <link rel="stylesheet" href="css/style.css">
  <style>
    .top-bar {
      background: var(--white);
      padding: var(--space-5) var(--space-6);
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid var(--gray-3);
    }

    .stats-cards {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: var(--space-4);
      margin-bottom: var(--space-6);
    }

    .stat-card {
      background: var(--white);
      padding: var(--space-5);
      border-radius: var(--radius-lg);
      border: 1px solid var(--gray-3);
    }

    .stat-label {
      color: var(--secondary);
      font-size: 12px;
      margin-bottom: var(--space-2);
    }

    .stat-value {
      font-size: 24px;
      font-weight: 600;
      color: var(--heading);
    }

    .stat-trend {
      font-size: 12px;
      margin-top: var(--space-2);
    }

    .stat-trend.up {
      color: var(--success);
    }

    .stat-trend.down {
      color: var(--error);
    }

    .filter-bar {
      background: var(--white);
      padding: var(--space-4) var(--space-5);
      border-radius: var(--radius-lg);
      margin-bottom: var(--space-4);
      display: flex;
      gap: var(--space-4);
      align-items: center;
      flex-wrap: wrap;
    }

    .filter-item {
      display: flex;
      align-items: center;
      gap: var(--space-2);
    }

    .list-container {
      background: var(--white);
      border-radius: var(--radius-lg);
      overflow: hidden;
    }

    .list-header {
      padding: var(--space-4) var(--space-5);
      border-bottom: 1px solid var(--gray-3);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .status-badge {
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
    }

    .status-draft {
      background: var(--gray-2);
      color: var(--secondary);
    }

    .status-pending {
      background: var(--warning-bg);
      color: var(--warning);
    }

    .status-running {
      background: var(--info-bg);
      color: var(--info);
    }

    .status-success {
      background: var(--success-bg);
      color: var(--success);
    }

    .status-partial {
      background: #FFF7E6;
      color: #FA8C16;
    }

    .status-failed {
      background: var(--error-bg);
      color: var(--error);
    }

    .empty-state {
      text-align: center;
      padding: 80px 40px;
    }

    .empty-icon {
      font-size: 64px;
      margin-bottom: var(--space-4);
      opacity: 0.3;
    }

    .empty-text {
      color: var(--secondary);
      margin-bottom: var(--space-6);
    }

    .action-buttons {
      display: flex;
      gap: var(--space-2);
    }

    .id-text {
      font-family: 'Monaco', 'Consolas', monospace;
      color: var(--primary-6);
      font-weight: 500;
    }

    .progress-bar-wrapper {
      width: 100%;
      margin-top: 4px;
    }

    .progress-text {
      font-size: 12px;
      color: var(--secondary);
      margin-top: 2px;
    }
  </style>
</head>
<body>
  <div class="page-container">
    <!-- é¡¶éƒ¨æ  -->
    <div class="top-bar">
      <div>
        <h1 style="margin-bottom: 4px;">æ‰¹é‡åˆ›ç¼–ç®¡ç†</h1>
        <p style="color: var(--secondary); font-size: 14px;">ç®¡ç†å’Œè·Ÿè¸ªæ‰€æœ‰æ‰¹é‡åˆ›ç¼–ä»»åŠ¡</p>
      </div>
      <div class="flex gap-3">
        <button class="btn btn-default">
          ğŸ“Š æ•°æ®æŠ¥è¡¨
        </button>
        <button class="btn btn-default">
          âš™ï¸ æ¨¡æ¿ç®¡ç†
        </button>
        <button class="btn btn-primary btn-large" onclick="createNew()">
          â• æ–°å»ºåˆ›ç¼–
        </button>
      </div>
    </div>

    <!-- ä¸»è¦å†…å®¹ -->
    <div class="page-content fade-in">
      <!-- ç»Ÿè®¡å¡ç‰‡ -->
      <div class="stats-cards">
        <div class="stat-card">
          <div class="stat-label">æ€»åˆ›ç¼–ä»»åŠ¡</div>
          <div class="stat-value" id="totalTasks">12</div>
          <div class="stat-trend up">â†‘ è¾ƒä¸Šå‘¨ +3</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">æ‰§è¡Œä¸­ä»»åŠ¡</div>
          <div class="stat-value" id="runningTasks">2</div>
          <div class="stat-trend">å®æ—¶æ›´æ–°</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">ä»Šæ—¥å®Œæˆ</div>
          <div class="stat-value" id="todayComplete">5</div>
          <div class="stat-trend up">â†‘ æˆåŠŸç‡ 95%</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">ç´¯è®¡ç”Ÿæˆå¹¿å‘Š</div>
          <div class="stat-value" id="totalAds">3,486</div>
          <div class="stat-trend up">â†‘ +328</div>
        </div>
      </div>

      <!-- ç­›é€‰æ  -->
      <div class="filter-bar">
        <div class="filter-item">
          <label>çŠ¶æ€ï¼š</label>
          <select id="statusFilter" class="input" style="width: 150px;" onchange="filterList()">
            <option value="">å…¨éƒ¨çŠ¶æ€</option>
            <option value="draft">è‰ç¨¿</option>
            <option value="pending">å¾…æ‰§è¡Œ</option>
            <option value="running">æ‰§è¡Œä¸­</option>
            <option value="success">å·²å®Œæˆ</option>
            <option value="partial">éƒ¨åˆ†æˆåŠŸ</option>
            <option value="failed">å¤±è´¥</option>
          </select>
        </div>

        <div class="filter-item">
          <label>åˆ›å»ºæ—¶é—´ï¼š</label>
          <select class="input" style="width: 150px;">
            <option>å…¨éƒ¨æ—¶é—´</option>
            <option>ä»Šå¤©</option>
            <option>æœ€è¿‘7å¤©</option>
            <option>æœ€è¿‘30å¤©</option>
          </select>
        </div>

        <div class="filter-item" style="flex: 1;">
          <input
            type="text"
            id="searchInput"
            class="input"
            placeholder="æœç´¢åˆ›ç¼–IDã€ä»»åŠ¡åç§°..."
            oninput="debounce(filterList, 300)()"
            style="width: 100%; max-width: 400px;"
          >
        </div>

        <button class="btn btn-text" onclick="resetFilters()">
          é‡ç½®ç­›é€‰
        </button>
      </div>

      <!-- åˆ—è¡¨å®¹å™¨ -->
      <div class="list-container">
        <div class="list-header">
          <div>
            <span>å…± </span>
            <strong id="listCount">12</strong>
            <span> æ¡è®°å½•</span>
          </div>
          <div class="flex gap-2">
            <button class="btn btn-text btn-small">å¯¼å‡ºåˆ—è¡¨</button>
            <button class="btn btn-text btn-small" onclick="refreshList()">ğŸ”„ åˆ·æ–°</button>
          </div>
        </div>

        <!-- è¡¨æ ¼ -->
        <div class="table-wrapper">
          <table class="table" id="taskTable">
            <thead>
              <tr>
                <th style="width: 100px;">åˆ›ç¼–ID</th>
                <th style="width: 250px;">ä»»åŠ¡åç§°</th>
                <th style="width: 100px;">é¢„è®¡è®¡åˆ’æ•°</th>
                <th style="width: 150px;">åˆ›å»ºäººå‘˜</th>
                <th style="width: 160px;">åˆ›å»ºæ—¶é—´</th>
                <th style="width: 120px;">æ‰§è¡ŒçŠ¶æ€</th>
                <th style="width: 200px;">æ“ä½œ</th>
              </tr>
            </thead>
            <tbody id="taskTableBody">
              <!-- æ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€å¡«å…… -->
            </tbody>
          </table>
        </div>

        <!-- åˆ†é¡µ -->
        <div style="padding: var(--space-4); border-top: 1px solid var(--gray-3); display: flex; justify-content: space-between; align-items: center;">
          <div style="color: var(--secondary); font-size: 14px;">
            æ˜¾ç¤º <span id="pageStart">1</span> - <span id="pageEnd">10</span>ï¼Œå…± <span id="pageTotal">12</span> æ¡
          </div>
          <div class="flex gap-2">
            <button class="btn btn-default btn-small" onclick="previousPage()" id="prevBtn">ä¸Šä¸€é¡µ</button>
            <button class="btn btn-default btn-small" onclick="nextPage()" id="nextBtn">ä¸‹ä¸€é¡µ</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- è¯¦æƒ…å¼¹çª— -->
  <div id="detailModal" class="modal-mask">
    <div class="modal" style="max-width: 800px;">
      <div class="modal-header">
        <span>åˆ›ç¼–ä»»åŠ¡è¯¦æƒ…</span>
        <button class="modal-close">Ã—</button>
      </div>
      <div class="modal-body" id="detailContent">
        <!-- è¯¦æƒ…å†…å®¹å°†åŠ¨æ€å¡«å…… -->
      </div>
      <div class="modal-footer">
        <button class="btn btn-default" onclick="hideDetail()">å…³é—­</button>
        <button class="btn btn-primary" onclick="copyTask(currentTaskId)">å¤åˆ¶åˆ›å»º</button>
      </div>
    </div>
  </div>

  <!-- åˆ é™¤ç¡®è®¤å¼¹çª— -->
  <div id="deleteModal" class="modal-mask">
    <div class="modal" style="max-width: 400px;">
      <div class="modal-header">
        <span>ç¡®è®¤åˆ é™¤</span>
        <button class="modal-close">Ã—</button>
      </div>
      <div class="modal-body">
        <div class="alert alert-warning">
          <span>âš ï¸</span>
          <span>åˆ é™¤åå°†æ— æ³•æ¢å¤ï¼Œç¡®å®šè¦åˆ é™¤è¿™ä¸ªåˆ›ç¼–ä»»åŠ¡å—ï¼Ÿ</span>
        </div>
        <p style="margin-top: 16px; color: var(--secondary);">
          ä»»åŠ¡ID: <span class="id-text" id="deleteTaskId"></span>
        </p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-default" onclick="hideDelete()">å–æ¶ˆ</button>
        <button class="btn btn-danger" onclick="confirmDelete()">ç¡®è®¤åˆ é™¤</button>
      </div>
    </div>
  </div>

  <script src="js/main.js"></script>
  <script>
    let detailModal, deleteModal;
    let currentTaskId = null;
    let taskToDelete = null;
    let currentPage = 1;
    let pageSize = 10;
    let allTasks = [];

    // æ¨¡æ‹Ÿæ•°æ®
    const mockTasks = [
      {
        id: '100234567',
        name: 'åŒ—äº¬åœ°åŒº-æ‰‹æœºäº§å“æ¨å¹¿-æ˜¥å­£ä¿ƒé”€',
        planCount: 24,
        creator: 'å¼ ä¸‰',
        createTime: '2026-01-15 14:30:25',
        status: 'success',
        actualCount: 24,
        successCount: 24,
        failedCount: 0,
        config: {
          cities: ['åŒ—äº¬', 'ä¸Šæµ·', 'å¹¿å·', 'æ·±åœ³'],
          products: ['æ‰‹æœº', 'å¹³æ¿', 'ç¬”è®°æœ¬'],
          materials: 2
        }
      },
      {
        id: '100234568',
        name: 'å…¨å›½å¤šåŸå¸‚-ç”µå­äº§å“å¤§ä¿ƒ',
        planCount: 48,
        creator: 'æå››',
        createTime: '2026-01-15 13:15:10',
        status: 'running',
        actualCount: 32,
        successCount: 32,
        failedCount: 0,
        progress: 67,
        config: {}
      },
      {
        id: '100234569',
        name: 'ä¸Šæµ·-å¤å­£æ–°å“å‘å¸ƒ',
        planCount: 12,
        creator: 'ç‹äº”',
        createTime: '2026-01-15 11:20:45',
        status: 'partial',
        actualCount: 12,
        successCount: 10,
        failedCount: 2,
        config: {}
      },
      {
        id: '100234570',
        name: 'æ·±åœ³-APPä¸‹è½½æ¨å¹¿',
        planCount: 30,
        creator: 'èµµå…­',
        createTime: '2026-01-15 10:05:30',
        status: 'pending',
        actualCount: 0,
        successCount: 0,
        failedCount: 0,
        config: {}
      },
      {
        id: '100234571',
        name: 'å¹¿å·-æœ¬åœ°æœåŠ¡æŠ•æ”¾æµ‹è¯•',
        planCount: 6,
        creator: 'å¼ ä¸‰',
        createTime: '2026-01-15 09:30:15',
        status: 'draft',
        actualCount: 0,
        successCount: 0,
        failedCount: 0,
        config: {}
      },
      {
        id: '100234572',
        name: 'æˆéƒ½-åŒºåŸŸæŠ•æ”¾å®éªŒ',
        planCount: 18,
        creator: 'æå››',
        createTime: '2026-01-14 16:45:20',
        status: 'failed',
        actualCount: 0,
        successCount: 0,
        failedCount: 18,
        errorMsg: 'APIé™æµï¼Œè¯·ç¨åé‡è¯•',
        config: {}
      },
      {
        id: '100234573',
        name: 'æ­å·-å“ç‰Œå¹¿å‘ŠæŠ•æ”¾',
        planCount: 36,
        creator: 'ç‹äº”',
        createTime: '2026-01-14 15:20:10',
        status: 'success',
        actualCount: 36,
        successCount: 36,
        failedCount: 0,
        config: {}
      },
      {
        id: '100234574',
        name: 'å—äº¬-å­£åº¦è¥é”€æ´»åŠ¨',
        planCount: 15,
        creator: 'èµµå…­',
        createTime: '2026-01-14 14:10:55',
        status: 'success',
        actualCount: 15,
        successCount: 15,
        failedCount: 0,
        config: {}
      },
      {
        id: '100234575',
        name: 'é‡åº†-æ–°ç”¨æˆ·æ‹‰æ–°',
        planCount: 20,
        creator: 'å¼ ä¸‰',
        createTime: '2026-01-14 11:30:40',
        status: 'pending',
        actualCount: 0,
        successCount: 0,
        failedCount: 0,
        config: {}
      },
      {
        id: '100234576',
        name: 'è¥¿å®‰-åŒåä¸€é¢„çƒ­',
        planCount: 60,
        creator: 'æå››',
        createTime: '2026-01-14 10:15:25',
        status: 'success',
        actualCount: 60,
        successCount: 58,
        failedCount: 0,
        config: {}
      },
      {
        id: '100234577',
        name: 'æ­¦æ±‰-å‘¨å¹´åº†å…¸æ¨å¹¿',
        planCount: 8,
        creator: 'ç‹äº”',
        createTime: '2026-01-13 17:20:15',
        status: 'draft',
        actualCount: 0,
        successCount: 0,
        failedCount: 0,
        config: {}
      },
      {
        id: '100234578',
        name: 'é•¿æ²™-æµ‹è¯•æ‰¹é‡åˆ›å»º',
        planCount: 3,
        creator: 'èµµå…­',
        createTime: '2026-01-13 16:05:50',
        status: 'success',
        actualCount: 3,
        successCount: 3,
        failedCount: 0,
        config: {}
      }
    ];

    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
      detailModal = new Modal('detailModal');
      deleteModal = new Modal('deleteModal');
      allTasks = mockTasks;
      renderTable();
      updateStats();
    });

    // æ¸²æŸ“è¡¨æ ¼
    function renderTable() {
      const tbody = document.getElementById('taskTableBody');
      const statusFilter = document.getElementById('statusFilter').value;
      const searchText = document.getElementById('searchInput').value.toLowerCase();

      // ç­›é€‰æ•°æ®
      let filteredTasks = allTasks.filter(task => {
        const matchStatus = !statusFilter || task.status === statusFilter;
        const matchSearch = !searchText ||
          task.id.includes(searchText) ||
          task.name.toLowerCase().includes(searchText);
        return matchStatus && matchSearch;
      });

      // åˆ†é¡µ
      const start = (currentPage - 1) * pageSize;
      const end = start + pageSize;
      const pageTasks = filteredTasks.slice(start, end);

      // æ¸…ç©ºè¡¨æ ¼
      tbody.innerHTML = '';

      // å¡«å……æ•°æ®
      if (pageTasks.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="7">
              <div class="empty-state">
                <div class="empty-icon">ğŸ“­</div>
                <div class="empty-text">æš‚æ— æ•°æ®</div>
              </div>
            </td>
          </tr>
        `;
      } else {
        pageTasks.forEach(task => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td><span class="id-text">${task.id}</span></td>
            <td>
              <div style="font-weight: 500;">${task.name}</div>
              ${task.status === 'running' ? `
                <div class="progress-bar-wrapper">
                  <div class="progress">
                    <div class="progress-bar" style="width: ${task.progress}%"></div>
                  </div>
                  <div class="progress-text">${task.actualCount}/${task.planCount} (${task.progress}%)</div>
                </div>
              ` : ''}
            </td>
            <td>${task.planCount}</td>
            <td>${task.creator}</td>
            <td style="font-size: 13px;">${task.createTime}</td>
            <td>${getStatusBadge(task)}</td>
            <td>
              <div class="action-buttons">
                <button class="btn btn-text btn-small" onclick="viewDetail('${task.id}')">
                  æŸ¥çœ‹
                </button>
                ${task.status === 'draft' ? `
                  <button class="btn btn-text btn-small" onclick="continueEdit('${task.id}')">
                    ç¼–è¾‘
                  </button>
                ` : `
                  <button class="btn btn-text btn-small" onclick="copyTask('${task.id}')">
                    å¤åˆ¶
                  </button>
                `}
                ${task.status === 'draft' || task.status === 'failed' ? `
                  <button class="btn btn-text btn-small text-error" onclick="deleteTask('${task.id}')">
                    åˆ é™¤
                  </button>
                ` : ''}
              </div>
            </td>
          `;
          tbody.appendChild(row);
        });
      }

      // æ›´æ–°åˆ†é¡µä¿¡æ¯
      document.getElementById('listCount').textContent = filteredTasks.length;
      document.getElementById('pageStart').textContent = filteredTasks.length > 0 ? start + 1 : 0;
      document.getElementById('pageEnd').textContent = Math.min(end, filteredTasks.length);
      document.getElementById('pageTotal').textContent = filteredTasks.length;

      // æ›´æ–°åˆ†é¡µæŒ‰é’®çŠ¶æ€
      document.getElementById('prevBtn').disabled = currentPage === 1;
      document.getElementById('nextBtn').disabled = end >= filteredTasks.length;
    }

    // è·å–çŠ¶æ€å¾½ç« 
    function getStatusBadge(task) {
      const statusMap = {
        draft: { class: 'status-draft', text: 'è‰ç¨¿' },
        pending: { class: 'status-pending', text: 'å¾…æ‰§è¡Œ' },
        running: { class: 'status-running', text: 'æ‰§è¡Œä¸­' },
        success: { class: 'status-success', text: 'å·²å®Œæˆ' },
        partial: { class: 'status-partial', text: 'éƒ¨åˆ†æˆåŠŸ' },
        failed: { class: 'status-failed', text: 'å¤±è´¥' }
      };

      const status = statusMap[task.status] || statusMap.draft;
      let badge = `<span class="status-badge ${status.class}">${status.text}</span>`;

      if (task.status === 'success' || task.status === 'partial') {
        badge += `<div style="font-size: 11px; color: var(--secondary); margin-top: 4px;">
          æˆåŠŸ ${task.successCount}/${task.actualCount}
        </div>`;
      }

      return badge;
    }

    // æ›´æ–°ç»Ÿè®¡æ•°æ®
    function updateStats() {
      document.getElementById('totalTasks').textContent = allTasks.length;
      document.getElementById('runningTasks').textContent =
        allTasks.filter(t => t.status === 'running').length;
      document.getElementById('todayComplete').textContent =
        allTasks.filter(t => t.status === 'success' && t.createTime.startsWith('2026-01-15')).length;

      const totalAds = allTasks.reduce((sum, t) => sum + (t.successCount || 0), 0);
      document.getElementById('totalAds').textContent = totalAds.toLocaleString();
    }

    // ç­›é€‰åˆ—è¡¨
    function filterList() {
      currentPage = 1;
      renderTable();
    }

    // é‡ç½®ç­›é€‰
    function resetFilters() {
      document.getElementById('statusFilter').value = '';
      document.getElementById('searchInput').value = '';
      filterList();
    }

    // åˆ·æ–°åˆ—è¡¨
    function refreshList() {
      Message.success('åˆ—è¡¨å·²åˆ·æ–°');
      renderTable();
      updateStats();
    }

    // ä¸Šä¸€é¡µ
    function previousPage() {
      if (currentPage > 1) {
        currentPage--;
        renderTable();
      }
    }

    // ä¸‹ä¸€é¡µ
    function nextPage() {
      currentPage++;
      renderTable();
    }

    // æ–°å»ºåˆ›ç¼–
    function createNew() {
      window.location.href = 'create-new.html';
    }

    // æŸ¥çœ‹è¯¦æƒ…
    function viewDetail(taskId) {
      currentTaskId = taskId;
      const task = allTasks.find(t => t.id === taskId);
      if (!task) return;

      const content = document.getElementById('detailContent');
      content.innerHTML = `
        <div style="line-height: 2;">
          <h3 style="margin-bottom: 16px;">${task.name}</h3>

          <div style="display: grid; grid-template-columns: 120px 1fr; gap: 12px; margin-bottom: 24px;">
            <div style="color: var(--secondary);">åˆ›ç¼–ID:</div>
            <div class="id-text">${task.id}</div>

            <div style="color: var(--secondary);">åˆ›å»ºäººå‘˜:</div>
            <div>${task.creator}</div>

            <div style="color: var(--secondary);">åˆ›å»ºæ—¶é—´:</div>
            <div>${task.createTime}</div>

            <div style="color: var(--secondary);">æ‰§è¡ŒçŠ¶æ€:</div>
            <div>${getStatusBadge(task)}</div>

            <div style="color: var(--secondary);">é¢„è®¡è®¡åˆ’æ•°:</div>
            <div>${task.planCount}</div>

            ${task.actualCount > 0 ? `
              <div style="color: var(--secondary);">å®é™…ç”Ÿæˆ:</div>
              <div>${task.actualCount}</div>

              <div style="color: var(--secondary);">æˆåŠŸ/å¤±è´¥:</div>
              <div>
                <span class="text-success">${task.successCount} æˆåŠŸ</span>
                ${task.failedCount > 0 ? `/ <span class="text-error">${task.failedCount} å¤±è´¥</span>` : ''}
              </div>
            ` : ''}

            ${task.errorMsg ? `
              <div style="color: var(--secondary);">å¤±è´¥åŸå› :</div>
              <div class="text-error">${task.errorMsg}</div>
            ` : ''}
          </div>

          ${Object.keys(task.config).length > 0 ? `
            <h4 style="margin-bottom: 12px;">é…ç½®ä¿¡æ¯</h4>
            <div style="background: var(--gray-1); padding: 16px; border-radius: var(--radius-md);">
              ${task.config.cities ? `<div>åŸå¸‚: ${task.config.cities.join(', ')}</div>` : ''}
              ${task.config.products ? `<div>äº§å“: ${task.config.products.join(', ')}</div>` : ''}
              ${task.config.materials ? `<div>ç´ ææ•°: ${task.config.materials}</div>` : ''}
            </div>
          ` : ''}
        </div>
      `;

      detailModal.show();
    }

    // éšè—è¯¦æƒ…
    function hideDetail() {
      detailModal.hide();
    }

    // ç»§ç»­ç¼–è¾‘
    function continueEdit(taskId) {
      DataStore.save('editingTaskId', taskId);
      Message.info('æ­£åœ¨åŠ è½½è‰ç¨¿...');
      setTimeout(() => {
        window.location.href = 'config-campaign.html';
      }, 500);
    }

    // å¤åˆ¶ä»»åŠ¡
    function copyTask(taskId) {
      const task = allTasks.find(t => t.id === taskId);
      if (!task) return;

      DataStore.save('copyFromTaskId', taskId);
      Message.success('æ­£åœ¨å¤åˆ¶åˆ›ç¼–é…ç½®...');
      setTimeout(() => {
        window.location.href = 'config-campaign.html';
      }, 500);
    }

    // åˆ é™¤ä»»åŠ¡
    function deleteTask(taskId) {
      taskToDelete = taskId;
      const task = allTasks.find(t => t.id === taskId);
      if (task) {
        document.getElementById('deleteTaskId').textContent = task.id;
        deleteModal.show();
      }
    }

    // éšè—åˆ é™¤å¼¹çª—
    function hideDelete() {
      deleteModal.hide();
      taskToDelete = null;
    }

    // ç¡®è®¤åˆ é™¤
    function confirmDelete() {
      if (taskToDelete) {
        allTasks = allTasks.filter(t => t.id !== taskToDelete);
        Message.success('åˆ é™¤æˆåŠŸ');
        hideDelete();
        renderTable();
        updateStats();
      }
    }

    // å®šæ—¶æ›´æ–°æ‰§è¡Œä¸­çš„ä»»åŠ¡è¿›åº¦
    setInterval(() => {
      let hasRunning = false;
      allTasks.forEach(task => {
        if (task.status === 'running') {
          hasRunning = true;
          if (task.progress < 100) {
            task.progress += Math.floor(Math.random() * 10);
            task.actualCount = Math.floor(task.planCount * task.progress / 100);
            task.successCount = task.actualCount;
            if (task.progress >= 100) {
              task.progress = 100;
              task.status = 'success';
              task.actualCount = task.planCount;
              task.successCount = task.planCount;
            }
          }
        }
      });
      if (hasRunning) {
        renderTable();
        updateStats();
      }
    }, 3000);
  </script>
</body>
</html>
